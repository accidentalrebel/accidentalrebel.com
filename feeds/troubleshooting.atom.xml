<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>AccidentalRebel.com - troubleshooting</title><link href="http://www.accidentalrebel.com/" rel="alternate"></link><link href="http://www.accidentalrebel.com/feeds/troubleshooting.atom.xml" rel="self"></link><id>http://www.accidentalrebel.com/</id><updated>2022-06-25T17:16:00+08:00</updated><entry><title>The password supplied to the Desired State Configuration resource MSFT_xADDomain is not valid</title><link href="http://www.accidentalrebel.com/the-password-supplied-to-the-desired-state-configuration-resource-msft_xaddomain-is-not-valid.html" rel="alternate"></link><published>2022-06-25T17:16:00+08:00</published><updated>2022-06-25T17:16:00+08:00</updated><author><name>AccidentalRebel</name></author><id>tag:www.accidentalrebel.com,2022-06-25:/the-password-supplied-to-the-desired-state-configuration-resource-msft_xaddomain-is-not-valid.html</id><summary type="html">&lt;p&gt;I wanted to quickly setup an Azure AD environment so I tried using this &lt;a href="https://github.com/Azure/azure-quickstart-templates/tree/master/application-workloads/active-directory/active-directory-new-domain"&gt;Azure quickstart template&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The resources were being created properly until I reached the part where the AD Forest was being created. The error that popped up was this:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;{&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;code&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;:&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;DeploymentFailed&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;,&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;message&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;:&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;At least one resource deployment operation failed. Please list deployment operations for details. Please see https://aka.ms/DeployOperations for usage details.&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;,&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;details&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;:[{&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;code&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;:&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;VMExtensionProvisioningError&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;,&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;message&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;:&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;VM has reported a failure when processing extension &amp;#39;CreateADForest&amp;#39;. Error message: \&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;DSC&lt;/span&gt; &lt;span class="nv"&gt;Configuration&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="s"&gt;CreateADPDCf&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt; &lt;span class="nv"&gt;completed&lt;/span&gt; &lt;span class="nv"&gt;with&lt;/span&gt; &lt;span class="nv"&gt;error&lt;/span&gt;&lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;s&lt;/span&gt;&lt;span class="ss"&gt;)&lt;/span&gt;. &lt;span class="nv"&gt;Following&lt;/span&gt; &lt;span class="nv"&gt;are&lt;/span&gt; &lt;span class="nv"&gt;the&lt;/span&gt; &lt;span class="nv"&gt;first&lt;/span&gt; &lt;span class="nv"&gt;few&lt;/span&gt;: &lt;span class="nv"&gt;The&lt;/span&gt; &lt;span class="nv"&gt;password&lt;/span&gt; &lt;span class="nv"&gt;supplied&lt;/span&gt; &lt;span class="nv"&gt;to&lt;/span&gt; &lt;span class="nv"&gt;the&lt;/span&gt; &lt;span class="nv"&gt;Desired&lt;/span&gt; &lt;span class="nv"&gt;State&lt;/span&gt; &lt;span class="nv"&gt;Configuration&lt;/span&gt; &lt;span class="nv"&gt;resource&lt;/span&gt; &lt;span class="nv"&gt;MSFT_xADDomain&lt;/span&gt; &lt;span class="nv"&gt;is&lt;/span&gt; &lt;span class="nv"&gt;not&lt;/span&gt; &lt;span class="nv"&gt;valid&lt;/span&gt;. &lt;span class="nv"&gt;The&lt;/span&gt; &lt;span class="nv"&gt;password&lt;/span&gt; &lt;span class="nv"&gt;cannot&lt;/span&gt; &lt;span class="nv"&gt;be&lt;/span&gt; &lt;span class="nv"&gt;null&lt;/span&gt; &lt;span class="nv"&gt;or&lt;/span&gt; &lt;span class="nv"&gt;empty&lt;/span&gt;. &lt;span class="nv"&gt;The&lt;/span&gt; &lt;span class="nv"&gt;SendConfigurationApply&lt;/span&gt; &lt;span class="nv"&gt;function&lt;/span&gt; &lt;span class="nv"&gt;did&lt;/span&gt; &lt;span class="nv"&gt;not&lt;/span&gt; &lt;span class="nv"&gt;succeed&lt;/span&gt;.\&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;\r&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;\r&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;More information on troubleshooting is available at https://aka.ms/VMExtensionDSCWindowsTroubleshoot &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;}]}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Searching around for a solution I chanced upon &lt;a href="https://github.com/Azure/azure-quickstart-templates/issues/12538"&gt;this Github issue&lt;/a&gt; from the same repository.&lt;/p&gt;
&lt;p&gt;A user commented that:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;"This issue seems to be caused by a security update on Windows and affects templates which use the Azure DSC extension to pass credentials (so probably many)."&lt;/p&gt;
&lt;p&gt;"As a quick workaround, I hardcode a previous version of the Windows Server images which do not cause this issue (instead of using latest)."&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;I looked at the fixes that the user did. It wasn't exactly for the error I am experiencing, but it was worth trying out.&lt;/p&gt;
&lt;p&gt;What I had to do was to look for an old version of the VM image for WindowsServer that is â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;I wanted to quickly setup an Azure AD environment so I tried using this &lt;a href="https://github.com/Azure/azure-quickstart-templates/tree/master/application-workloads/active-directory/active-directory-new-domain"&gt;Azure quickstart template&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The resources were being created properly until I reached the part where the AD Forest was being created. The error that popped up was this:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;{&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;code&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;:&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;DeploymentFailed&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;,&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;message&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;:&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;At least one resource deployment operation failed. Please list deployment operations for details. Please see https://aka.ms/DeployOperations for usage details.&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;,&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;details&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;:[{&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;code&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;:&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;VMExtensionProvisioningError&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;,&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;message&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;:&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;VM has reported a failure when processing extension &amp;#39;CreateADForest&amp;#39;. Error message: \&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;DSC&lt;/span&gt; &lt;span class="nv"&gt;Configuration&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="s"&gt;CreateADPDCf&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt; &lt;span class="nv"&gt;completed&lt;/span&gt; &lt;span class="nv"&gt;with&lt;/span&gt; &lt;span class="nv"&gt;error&lt;/span&gt;&lt;span class="ss"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;s&lt;/span&gt;&lt;span class="ss"&gt;)&lt;/span&gt;. &lt;span class="nv"&gt;Following&lt;/span&gt; &lt;span class="nv"&gt;are&lt;/span&gt; &lt;span class="nv"&gt;the&lt;/span&gt; &lt;span class="nv"&gt;first&lt;/span&gt; &lt;span class="nv"&gt;few&lt;/span&gt;: &lt;span class="nv"&gt;The&lt;/span&gt; &lt;span class="nv"&gt;password&lt;/span&gt; &lt;span class="nv"&gt;supplied&lt;/span&gt; &lt;span class="nv"&gt;to&lt;/span&gt; &lt;span class="nv"&gt;the&lt;/span&gt; &lt;span class="nv"&gt;Desired&lt;/span&gt; &lt;span class="nv"&gt;State&lt;/span&gt; &lt;span class="nv"&gt;Configuration&lt;/span&gt; &lt;span class="nv"&gt;resource&lt;/span&gt; &lt;span class="nv"&gt;MSFT_xADDomain&lt;/span&gt; &lt;span class="nv"&gt;is&lt;/span&gt; &lt;span class="nv"&gt;not&lt;/span&gt; &lt;span class="nv"&gt;valid&lt;/span&gt;. &lt;span class="nv"&gt;The&lt;/span&gt; &lt;span class="nv"&gt;password&lt;/span&gt; &lt;span class="nv"&gt;cannot&lt;/span&gt; &lt;span class="nv"&gt;be&lt;/span&gt; &lt;span class="nv"&gt;null&lt;/span&gt; &lt;span class="nv"&gt;or&lt;/span&gt; &lt;span class="nv"&gt;empty&lt;/span&gt;. &lt;span class="nv"&gt;The&lt;/span&gt; &lt;span class="nv"&gt;SendConfigurationApply&lt;/span&gt; &lt;span class="nv"&gt;function&lt;/span&gt; &lt;span class="nv"&gt;did&lt;/span&gt; &lt;span class="nv"&gt;not&lt;/span&gt; &lt;span class="nv"&gt;succeed&lt;/span&gt;.\&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;\r&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;\r&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;More information on troubleshooting is available at https://aka.ms/VMExtensionDSCWindowsTroubleshoot &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;}]}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Searching around for a solution I chanced upon &lt;a href="https://github.com/Azure/azure-quickstart-templates/issues/12538"&gt;this Github issue&lt;/a&gt; from the same repository.&lt;/p&gt;
&lt;p&gt;A user commented that:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;"This issue seems to be caused by a security update on Windows and affects templates which use the Azure DSC extension to pass credentials (so probably many)."&lt;/p&gt;
&lt;p&gt;"As a quick workaround, I hardcode a previous version of the Windows Server images which do not cause this issue (instead of using latest)."&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;I looked at the fixes that the user did. It wasn't exactly for the error I am experiencing, but it was worth trying out.&lt;/p&gt;
&lt;p&gt;What I had to do was to look for an old version of the VM image for WindowsServer that is needed by the quickstart template. The template's json file revealed that it's trying to use "2016-Datacenter".&lt;/p&gt;
&lt;p&gt;I tried using &lt;code&gt;az cli&lt;/code&gt; to check for the available vm images or WindowsServer:&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;az vm image list --offer WindowsServer --query [].urn
You are viewing an offline list of images, use --all to retrieve an up-to-date list
[
  &amp;quot;MicrosoftWindowsServer:WindowsServer:2022-Datacenter:latest&amp;quot;,
  &amp;quot;MicrosoftWindowsServer:WindowsServer:2022-datacenter-azure-edition-core:latest&amp;quot;,
  &amp;quot;MicrosoftWindowsServer:WindowsServer:2019-Datacenter:latest&amp;quot;,
  &amp;quot;MicrosoftWindowsServer:WindowsServer:2016-Datacenter:latest&amp;quot;,
  &amp;quot;MicrosoftWindowsServer:WindowsServer:2012-R2-Datacenter:latest&amp;quot;,
  &amp;quot;MicrosoftWindowsServer:WindowsServer:2012-Datacenter:latest&amp;quot;,
  &amp;quot;MicrosoftWindowsServer:WindowsServer:2008-R2-SP1:latest&amp;quot;
]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;However, the command only lists "latest", without a version number.&lt;/p&gt;
&lt;p&gt;After some searching, I finally found the list in Microsoft's support portal that &lt;a href="https://support.microsoft.com/en-au/topic/windows-server-images-for-may-2022-6d62b503-9a57-4774-a77a-f6c99224ccd2"&gt;lists the Windows Server Images from previous months&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img alt="the-password-supplied-to-the-desired-state-configuration-resource-msft_xaddomain-is-not-validd" src="http://www.accidentalrebel.com/images/the-password-supplied-to-the-desired-state-configuration-resource-msft_xaddomain-is-not-valid-01.png" /&gt;&lt;/p&gt;
&lt;p&gt;For my particular case, I used the version from the previous month, which was May, hence the value &lt;code&gt;14393.5125.220505&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;I then opened up &lt;code&gt;azuredeploy.json&lt;/code&gt; looked for the &lt;code&gt;imageReference&lt;/code&gt; entry. And changed the version to the value we got.&lt;/p&gt;
&lt;div class="codehilite"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;quot;imageReference&amp;quot;: {
     &amp;quot;publisher&amp;quot;: &amp;quot;MicrosoftWindowsServer&amp;quot;,
     &amp;quot;offer&amp;quot;: &amp;quot;WindowsServer&amp;quot;,
     &amp;quot;sku&amp;quot;: &amp;quot;2016-Datacenter&amp;quot;,
     &amp;quot;version&amp;quot;: &amp;quot;14393.5125.220505&amp;quot;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This fixed the issue and the template was able to create the resources successfully.&lt;/p&gt;</content><category term="troubleshooting"></category><category term="azure"></category><category term="error"></category><category term="troubleshooting"></category></entry></feed>