<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>AccidentalRebel.com - Articles by AccidentalRebel</title>
  <meta name="author" content="AccidentalRebel">

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="canonical" href="..">

  <link href="../favicon.png" rel="icon">

  <link href="http://www.accidentalrebel.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="AccidentalRebel.com Full Atom Feed" />

  <link href="../theme/css/screen.css"  media="screen, projection" rel="stylesheet" type="text/css" />
  <link href="../theme/css/tomorrow.css"  media="screen, projection" rel="stylesheet" type="text/css" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.js"></script>
  <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>


</head>
  <body>

    <div class="container" id="site-title">
      <div class="col-md-8 col-md-offset-2">
	<h1>
	  <a href="..">
	    AccidentalRebel.com
	  </a>
	</h1>
	<div id="profile">
	  <div class="left">
	    <img src="../theme/images/pic.png" />
	  </div>
	  <div class="right">
	    My name is Karlo and I'm currently employed as a Cyber Security Engineer. I have an interest in threat hunting and malware analysis. I also work on cyber-security related programming projects like malware analysis tools and remote access tools.
	  </div>
	  <div class="clear"></div>
	</div>
	<div id="nav">
	  <ul>
	    <li><a href="..">Home</a></li>
	    <!-- <li><a href="../pages/made.html">My Works</a></li> -->
	    <li class="icon-nav" id="twitter-nav"><a href="https://twitter.com/accidentalrebel">Twitter</a></li>
	    <li class="icon-nav" id="github-nav"><a href="https://github.com/accidentalrebel">Github</a></li>
	    <li class="icon-nav" id="feed-nav"><a href="./feeds/all.atom.xml">RSS</a></li>
	  </ul>
	</div>
      </div>
    </div>

<div class="container">
  <!-- CONTENT GOES HERE -->
  <div class="row">
    <div class="col-md-8 col-md-offset-2">
      <article>
        <h1><a href="../ioli-crackme-0x03.html">IOLI Crackme 0x03</a></h1>
	<div class="meta">
          <time datetime="2021-03-22T20:03:00+08:00">March 22, 2021</time>
          in <span class="categories">
            <a href="../tag/re.html">re</a>,            <a href="../tag/crackme.html">crackme</a>          </span>
	</div>
        <p><p>I am continuing my reverse engineering review by tackling the <em>IOLI crackmes</em> by <a href="https://twitter.com/pof">@pof</a>. These are beginner friendly challenges that is perfect for newbies or for those who want to review the basics like me. Check out my writeups for <a href="../ioli-crackme-0x00.html">0x00</a>, <a href="../ioli-crackme-0x01.html">0x01</a>, and <a href="../ioli-crackme-0x02.html">0x02</a>.</p>
<h1 id="getting-the-password">Getting the password</h1>
<p>After opening the program in IDA I immediately saw that the code is almost exactly as the one in challenge <a href="../ioli-crackme-0x02.html">0x02</a>, with the exception of our expected <code>cmp</code> command being inside the <code>_test</code> function.</p>
<p><img alt="ioli-crackme-0x03-01" src="../images/ioli-crackme-0x03-01.png" /></p>
<p>Reading through the code I realized that the password for this challenge is exactly the same as the previous one!</p>
<p>But what's this? The success and failure messages are all garbled? And plus, what is this other new function called <code>_shift</code>?</p>
<p><img alt="ioli-crackme-0x03-02" src="../images/ioli-crackme-0x03-02.png" /></p>
<h1 id="a-different-kind-of-challenge">A different kind of challenge</h1>
<p>Opening up the <code>_shift</code> function shows us a short, but interesting looking program flow with two branches and one of the branches looping back. It seems we have a <em>loop</em> here that we could investigate.</p>
<p><img alt="ioli-crackme-0x03-03" src="../images/ioli-crackme-0x03-03.png" /></p>
<p>If we look at the input that the function takes we will find out that the strings that are being passed from the <code>_test</code> function are <code>Lqydolg#Sdvvzrug$</code> and <code>Sdvvzrug#RN$$$#=,</code> for the <em>failure</em> and <em>success</em> messages, respectively. This tells us that a cipher is applied to these strings. What cipher it is using is what we'll be trying to find out.</p>
<h1 id="discovering-the-cipher">Discovering the cipher</h1>
<p>The best way to discover the cipher used is to step through the code. We can do it with both static or dynamic analysis, but the latter is way easier.</p>
<p><img alt="ioli-crackme-0x03-04" src="../images/ioli-crackme-0x03-04.png" /></p>
<p>The code above starts with <code>mov eax, [ebp+arg_0]</code> which copies the pointer to the string passed to our <code>_shift</code> function. We then copy that pointer to <code>[esp+98h+Str]</code> which is the memory location pointing to the top of the current stack. This is done so that it can be passed as an argument when we do <code>call _strlen</code>.</p>
<p>After executing, <code>_strlen</code> returns the length of the specified string and is saved to register <code>eax</code>. This is then used in the line <code>cmp [ebp+var_7C], eax</code>. </p>
<p>But what is the value of <code>var_7C</code>? If you scroll up at the start of the subroutine, <code>var_7C</code> is assigned a value of zero. If you know how loops work, you'll realize that this variable is going to be used to hold a counter value. It starts at a value of <code>0</code> and it will eventually be incremented after every loop, which is what is happening at <code>401348</code>.</p>
<p>To make it easy for us to remember this, let's rename <code>var_7C</code> to a more memorable name like <code>var_counter</code>.</p>
<p><img alt="ioli-crackme-0x03-05" src="../images/ioli-crackme-0x03-05.png" /></p>
<p>So going back, to the comparison command <code>cmp [ebp+var_counter], eax</code>, which now translates to <code>cmp 0, 17</code>. <em>17</em> being the length of our failure string <code>Lqydolg#Sdvvzrug$</code>. Since this is not equal it now goes to this next block of code.</p>
<p><img alt="ioli-crackme-0x03-06" src="../images/ioli-crackme-0x03-06.png" /></p>
<p>Now this block is interesting. There's a lot that is happening but the gist of it is that the program gets one character from the input string, with <code>var_counter</code> as an offset. It then decrements that character value by 3, and added to a destination string. I'll be going through the code that I described step by step in the next section.</p>
<h1 id="stepping-through">Stepping through</h1>
<p>So to start, <code>lea eax, [ebp+var_78]</code> loads the address to <code>var_78</code> which in my case points to the address <code>28FE90</code>.</p>
<p><code>mov edx, eax</code> copies that address to <code>edx</code> so we can use it on the next line.</p>
<p><code>add edx, [ebp+var_counter]</code> adds to the address of <code>var_78</code>. Because <code>var_counter</code> is still <code>0</code>, the address remains at <code>28FE90</code>.</p>
<p><code>add eax, [ebp+arg_0]</code> does the same thing as above but this time adding to <code>[arg_0]</code> which contains the address <code>28FF10</code>.</p>
<p><code>movzx eax, byte ptr [eax]</code> copies the byte contained in <code>[eax]</code> or <code>28FF10</code>. In this case that byte contains the value <code>4Ch</code> or <code>L</code> in ASCII. This is the first letter in our failure string <code>Lqydolg#Sdvvzrug$</code>!</p>
<p><code>sub al, 3</code> then substracts 3 to <code>4Ch</code> making it <code>49h</code> which is ASCII for <code>I</code>.</p>
<p><code>mov [edx], al</code> saves the new character to the variable <code>var_78</code> which is the memory location <code>28FE90</code>. At this point in time the content is currently the character <code>I</code>. To make it easy for us to understand the code, let's rename <code>var_78</code> to <code>var_dest</code>. This name is apt because this will be the destination for our shifted ASCII characters.</p>
<p><code>lea eax, [ebp+var_counter]</code> and then <code>inc dword ptr [eax]</code> now increments the value of <code>var_counter</code>, which now makes it an integer value of <code>1</code>.</p>
<h1 id="looping-back">Looping back</h1>
<p>Alright. Now we go back up again to <code>loc_401320</code>. I'm not going to step through each line again, but I will highlight the important parts now that we have looped back.</p>
<p><code>cmp [ebp+var_counter]</code> now translates to <code>cmp 1, 17</code>, which is still not equal.</p>
<p><code>add edx, [ebp+var_counter]</code> now adds 1 to our <code>var_dest</code> variable, turning <code>28FE90</code> to <code>28FE91</code>. The address for the <code>arg_0</code> variable is also added by 1 at <code>add eax, [ebp+arg_0]</code>.</p>
<p>By the time <code>movzx eax, byte ptr [eax]</code> is executed it now gets the next character in our failure string which is <code>71h</code> or the letter <code>q</code>.</p>
<p><code>sub al, 3</code> converts are letter <code>q</code> to the letter <code>n</code>. And is once again saved to our <code>var_dest</code> variable with the command <code>mov [edx], al</code>.</p>
<h1 id="repeat-until">Repeat until...</h1>
<p>If I haven't lost you, then you should now be able to follow what will happen in the next steps:</p>
<p><code>var_counter</code> will get incremented again and again, which will point to the next characters in the string. For example, the next characters: <code>y</code> then <code>d</code> then <code>o</code> will get shifted to <code>v</code> then <code>a</code> then <code>l</code>, respectively. This shifting of each characters will continue until <code>cmp [ebp+var_counter</code> equates to <code>cmp 17, 17</code>. </p>
<p>By the end, <code>var_dest</code> now contains the newly shifted string <code>Invalid Password!</code>. Finally! Applying the same code above to the success message, the garbled message would end with <code>Password OK!!! :)</code>.</p>
<p>Wasn't that fun?</p>
<h1 id="on-to-the-next-challenge">On to the next challenge</h1>
<p>I hope I was able to explain properly the simple shifting algorithm used by the program above. I did it this way mostly for my own benefit and to make sure I really did understand how the algorithm worked in assembly. In future writeups I'll refrain from stepping through code at such a granular level, unless there is something really important that warrants it. Or maybe a video would be a much better format for these kinds of challenges?</p>
<p>Anyway, I look forward to the next challenge. Hopefully, you are too!</p>
          <!-- <a class="full-article-link pull-right" rel="full-article" href="../ioli-crackme-0x03.html">Read on →</a> -->
      </article>
    </div>
  </div>
  <!-- CONTENT GOES HERE -->
  <div class="row">
    <div class="col-md-8 col-md-offset-2">
      <article>
        <h1><a href="../maldoc101-writeup-part-1.html">Maldoc101 Writeup (Part 1)</a></h1>
	<div class="meta">
          <time datetime="2021-03-13T08:34:00+08:00">March 13, 2021</time>
          in <span class="categories">
            <a href="../tag/re.html">re</a>,            <a href="../tag/malware_analysis.html">malware_analysis</a>,            <a href="../tag/malware.html">malware</a>          </span>
	</div>
        <p><p>This is part 1 out of 2 of my writeup for the Maldoc101 challenge made by Josh Stroschein (<a href="https://twitter.com/jstrosch">@jstrosch</a>) and is currently playable at <a href="https://cyberdefenders.org/labs/51">Cyberdefenders.Org</a>. I've done some maldoc analysis before but this is the first time I'm writing about my approach.</p>
<p>There is also an already existing writeup about this challenge <a href="https://github.com/jstrosch/malware-samples/blob/master/malware_analysis_exercises/2020/December/solution.md">from the creator himself</a>. You should check that out if you want a more detailed and focused writeup. This writeup is more from the perspective of someone relatively new to malware analysis. There's a lot more exploration and trial-and-error which, I hope, might give the reader a different view in how this kind of problem is approached.</p>
<h2 id="the-challenge">The challenge</h2>
<h3 id="name">Name</h3>
<p><a href="https://cyberdefenders.org/labs/51">MalDoc101 - Malicious Document</a></p>
<h3 id="description">Description</h3>
<p>It is common for threat actors to utilize living off the land (LOTL) techniques, such as the execution of PowerShell to further their attacks and transition from macro code. This challenge is intended to show how you can often times perform quick analysis to extract important IOCs. The focus of this exercise is on static techniques for analysis.</p>
<h3 id="suggested-tools">Suggested Tools</h3>
<ul>
<li>REMnux Virtual Machine (remnux.org)</li>
<li>Terminal/Command prompt w/ Python installed</li>
<li>Oledump</li>
<li>Text editor</li>
</ul>
<h2 id="the-easy-questions">The easy questions</h2>
<p>The first question seems very easy. The <em>suggested tools</em> section above also gives us an idea how to approach this.</p>
<blockquote>
<p>What streams contain macros in this document? (comma-separated, ascending).</p>
</blockquote>
<p><a href="https://blog.didierstevens.com/programs/oledump-py/">oledump.py</a> is a tool made by <a href="https://blog.didierstevens.com/about/">Didier Stevens</a> that allows the analysis of data streams found in OLE files such as MS Office documetns. Running the command below would show us which streams have macros in it. These are denoted with the character <em>M</em>.</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>oledump.py sample.bin
<span class="go">  1:       114 &#39;\x01CompObj&#39;</span>
<span class="go">  2:      4096 &#39;\x05DocumentSummaryInformation&#39;</span>
<span class="go">  3:      4096 &#39;\x05SummaryInformation&#39;</span>
<span class="go">  4:      7119 &#39;1Table&#39;</span>
<span class="go">  5:    101483 &#39;Data&#39;</span>
<span class="go">  6:       581 &#39;Macros/PROJECT&#39;</span>
<span class="go">  7:       119 &#39;Macros/PROJECTwm&#39;</span>
<span class="go">  8:     12997 &#39;Macros/VBA/_VBA_PROJECT&#39;</span>
<span class="go">  9:      2112 &#39;Macros/VBA/__SRP_0&#39;</span>
<span class="go"> 10:       190 &#39;Macros/VBA/__SRP_1&#39;</span>
<span class="go"> 11:       532 &#39;Macros/VBA/__SRP_2&#39;</span>
<span class="go"> 12:       156 &#39;Macros/VBA/__SRP_3&#39;</span>
<span class="go"> 13: M    1367 &#39;Macros/VBA/diakzouxchouz&#39;</span>
<span class="go"> 14:       908 &#39;Macros/VBA/dir&#39;</span>
<span class="go"> 15: M    5705 &#39;Macros/VBA/govwiahtoozfaid&#39;</span>
<span class="go"> 16: m    1187 &#39;Macros/VBA/roubhaol&#39;</span>
<span class="go"> 17:        97 &#39;Macros/roubhaol/\x01CompObj&#39;</span>
<span class="go"> ...</span>
</code></pre></div>

<p>I later noticed that there is an upper-case and lower-case <em>M</em>. I learned that the upper-case <em>M</em> denotes a macro with a code. The lower-case denotes a user form. This is a distinction that will be important later in this challenge.</p>
<hr />
<blockquote>
<p>What command-line argument with Oledump do you use to view the raw content of a stream? (Do not include the leading dash) </p>
</blockquote>
<p>The next question is another easy one which ran easily be solved through <code>oledump.py</code>'s <em>--help</em> parameter.</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>oledump.py --help
<span class="go">Usage: oledump.py [options] [file]</span>
<span class="go">Analyze OLE files (Compound Binary Files)</span>

<span class="go">Options:</span>
<span class="go">  --version             show program&#39;s version number and exit</span>
<span class="go">  -h, --help            show this help message and exit</span>
<span class="go">  -m, --man             Print manual</span>
<span class="go">  -s SELECT, --select=SELECT</span>
<span class="go">                        select item nr for dumping (a for all)</span>
<span class="go">  -d, --dump            perform dump</span>
<span class="go">  -x, --hexdump         perform hex dump</span>
<span class="go">  -a, --asciidump       perform ascii dump</span>
<span class="go">  -A, --asciidumprle    perform ascii dump with RLE</span>
<span class="go">  -S, --strings         perform strings dump</span>
<span class="go">  -T, --headtail        do head &amp; tail</span>
<span class="go">  -v, --vbadecompress   VBA decompression</span>
<span class="go">  ...</span>
</code></pre></div>

<p>The answer to question number two is easy to spot.</p>
<hr />
<blockquote>
<p>What event is used to begin the execution of the macros?  </p>
</blockquote>
<p>I used a different tool for this particular question mostly because I knew that it already shows the information I need to answer the question. The tool is called <code>olevba</code> which is part of the <a href="https://github.com/decalage2/oletools">oletools</a> package of Python tools. <em>Olevba</em> is used for extracting and analyzing VBA macro source code for MS Office documents.</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>olevba sample.bin
<span class="go">+----------+--------------------+---------------------------------------------+</span>
<span class="go">|Type      |Keyword             |Description                                  |</span>
<span class="go">+----------+--------------------+---------------------------------------------+</span>
<span class="go">|AutoExec  |Document_open       |Runs when the Word or Publisher document is  |</span>
<span class="go">|          |                    |opened                                       |</span>
<span class="go">|Suspicious|Create              |May execute file or a system command through |</span>
<span class="go">|          |                    |WMI                                          |</span>
<span class="go">|Suspicious|showwindow          |May hide the application                     |</span>
<span class="go">|Suspicious|CreateObject        |May create an OLE object                     |</span>
<span class="go">...</span>
</code></pre></div>

<h2 id="onto-the-main-event">Onto the main event</h2>
<blockquote>
<p>What malware family was this maldoc attempting to drop?</p>
</blockquote>
<p>I figured that the way for me to determine the answer for the question above is to start investigating the macro codes included in the document.</p>
<p>I knew from the previous question that the entry point to begin the execution of the macros is with the function <code>Document_open()</code>. The next step is to look for this entry point and go through the code to understand what the macro is doing.</p>
<p>To view the contents of a stream, I used the command below:</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>oledump.py sample.bin -s <span class="m">13</span> -v
<span class="go">Attribute VB_Name = &quot;diakzouxchouz&quot;</span>
<span class="go">Attribute VB_Base = &quot;1Normal.ThisDocument&quot;</span>
<span class="go">Attribute VB_GlobalNameSpace = False</span>
<span class="go">Attribute VB_Creatable = False</span>
<span class="go">Attribute VB_PredeclaredId = True</span>
<span class="go">Attribute VB_Exposed = True</span>
<span class="go">Attribute VB_TemplateDerived = True</span>
<span class="go">Attribute VB_Customizable = True</span>
<span class="go">Private Sub _</span>
<span class="go">Document_open()</span>
<span class="go">boaxvoebxiotqueb</span>
<span class="go">End Sub</span>
</code></pre></div>

<p>In the above output, I saw that <code>Document_open()</code> contains a single line of code which is a call to function <code>boaxvoebxiotqueb'</code>. This function is included in stream <code>15</code> which can be viewed with the command:</p>
<div class="codehilite"><pre><span></span><code>$ oledump.py sample.bin -s <span class="m">13</span> -v
Attribute <span class="nv">VB_Name</span> <span class="o">=</span> <span class="s2">&quot;govwiahtoozfaid&quot;</span>
Function boaxvoebxiotqueb<span class="o">()</span>
<span class="nv">gooykadheoj</span> <span class="o">=</span> Chr<span class="o">(</span>roubhaol.Zoom + Int<span class="o">(</span><span class="m">5</span> * <span class="m">3</span><span class="o">))</span>
Dim c7�ATOQe2�j As Integer
c7�ATOQe2�j <span class="o">=</span> <span class="m">6</span>
Do While c7�ATOQe2�j &lt; <span class="m">6</span> + <span class="m">2</span>
c7�ATOQe2�j <span class="o">=</span> c7�ATOQe2�j + <span class="m">5</span>: DoEvents
Loop
<span class="nv">haothkoebtheil</span> <span class="o">=</span> <span class="s2">&quot;2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fqw2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fqin2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fqm2342772g3&amp;*gs7712ffvs626fqgm2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fqt2342772g3&amp;*gs7712ffvs626fq&quot;</span> + gooykadheoj + <span class="s2">&quot;2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fq:w2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fqin2342772g3&amp;*gs7712ffvs626fq322342772g3&amp;*gs7712ffvs626fq_2342772g3&amp;*gs7712ffvs626fq&quot;</span> + roubhaol.joefwoefcheaw + <span class="s2">&quot;2342772g3&amp;*gs7712ffvs626fqr2342772g3&amp;*gs7712ffvs626fqo2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fqc2342772g3&amp;*gs7712ffvs626fqes2342772g3&amp;*gs7712ffvs626fqs2342772g3&amp;*gs7712ffvs626fq&quot;</span>
...
</code></pre></div>

<p>The above output contains more lines of what looks like gibberish code. Upon further inspection I realized that it's actually obfuscated. I can see common coding patterns which tells me that I could make sense of the code if I step through it and organize it so it is easy to understand.</p>
<p>The first line of the <code>boaxvoebxiotqueb</code> shows:</p>
<div class="codehilite"><pre><span></span><code>gooykadheoj = Chr(roubhaol.Zoom + Int(5 * 3))
</code></pre></div>

<p>What's <code>roubhaol</code>? Since this is the first line in the function, I know that it is not a locally defined variable. It must be declared somplace else.</p>
<p>After looking around I learned that <code>roubhaol</code> is a the name of the user form at stream <em>16</em>.</p>
<div class="codehilite"><pre><span></span><code><span class="go">16: m    1187 &#39;Macros/VBA/roubhaol&#39;</span>
</code></pre></div>

<p>So the next step is figuring out what <code>roubhaol.Zoom</code>'s value is. This value is not set anywhere in any of the macros by code. This means that the value is set in the form itself. To confirm, I opened up the Word document, pressed <code>Alt+F11</code> to open up the Visual Basic editor and then opened the <code>roubhaol</code> form. At the bottom we see that the value of <code>Zoom</code> is set to <code>100</code>.</p>
<p><img alt="maldoc101-writeup-01" src="../images/maldoc101-writeup-01.png" /></p>
<p>This means that by simulating the first line of code again we find that the variable <code>gooykadheoj</code> gets the character value of <code>s</code>.</p>
<div class="codehilite"><pre><span></span><code>gooykadheoj = Chr(roubhaol.Zoom + Int(5 * 3))
gooykadheoj = Chr(100 + Int(5 * 3))
gooykadheoj = Chr(115)
gooykadheoj = Chr(115) # character &quot;s&quot;
</code></pre></div>

<p>I then proceeded to go through the next set of lines.</p>
<div class="codehilite"><pre><span></span><code><span class="nv">Dim</span> <span class="nv">c7</span>�<span class="nv">ATOQe2</span>�<span class="nv">j</span> <span class="nv">As</span> <span class="nv">Integer</span>
<span class="nv">c7</span>�<span class="nv">ATOQe2</span>�<span class="nv">j</span> <span class="o">=</span> <span class="mi">6</span>
<span class="k">Do</span> <span class="k">While</span> <span class="nv">c7</span>�<span class="nv">ATOQe2</span>�<span class="nv">j</span> <span class="o">&lt;</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">2</span>
<span class="nv">c7</span>�<span class="nv">ATOQe2</span>�<span class="nv">j</span> <span class="o">=</span> <span class="nv">c7</span>�<span class="nv">ATOQe2</span>�<span class="nv">j</span> <span class="o">+</span> <span class="mi">5</span>: <span class="nv">DoEvents</span>
<span class="k">Loop</span>
</code></pre></div>

<p>This one is easier to simulate. <code>c7�ATOQe2�j</code> is assigend 6. And then there's a loop that adds <code>5</code> that eventually results to the value of <code>16</code>.</p>
<p>But wait, something is fishy here. The variable <code>c7�ATOQe2�j</code> is not found anywhere else after the block of code above. This tells us that this is just junk code that does not really do anything aside from waste an analyst's time! Sneaky sneaky.</p>
<p>To save me the time I proceeded to remove all junk code. I did this by going through each variables and seeing if they are used somewhere useful. If not, then they are safe to remove.</p>
<div class="codehilite"><pre><span></span><code><span class="nv">Attribute</span> <span class="nv">VB_Name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">govwiahtoozfaid</span><span class="s2">&quot;</span>
<span class="nv">Function</span> <span class="nv">boaxvoebxiotqueb</span><span class="ss">()</span>
    <span class="nv">gooykadheoj</span> <span class="o">=</span> <span class="nv">Chr</span><span class="ss">(</span><span class="nv">roubhaol</span>.<span class="nv">Zoom</span> <span class="o">+</span> <span class="nv">Int</span><span class="ss">(</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">3</span><span class="ss">))</span>

    <span class="nv">haothkoebtheil</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fqw2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fqin2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fqm2342772g3&amp;*gs7712ffvs626fqgm2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fqt2342772g3&amp;*gs7712ffvs626fq</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nv">gooykadheoj</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="s">2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fq:w2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fqin2342772g3&amp;*gs7712ffvs626fq322342772g3&amp;*gs7712ffvs626fq_2342772g3&amp;*gs7712ffvs626fq</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nv">roubhaol</span>.<span class="nv">joefwoefcheaw</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="s">2342772g3&amp;*gs7712ffvs626fqr2342772g3&amp;*gs7712ffvs626fqo2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fqc2342772g3&amp;*gs7712ffvs626fqes2342772g3&amp;*gs7712ffvs626fqs2342772g3&amp;*gs7712ffvs626fq</span><span class="s2">&quot;</span>

    <span class="nv">deulsaocthuul</span> <span class="o">=</span> <span class="nv">juuvzouchmiopxeox</span><span class="ss">(</span><span class="nv">haothkoebtheil</span><span class="ss">)</span>

    <span class="nv">Set</span> <span class="nv">tiajriokchaoy</span> <span class="o">=</span> <span class="nv">CreateObject</span><span class="ss">(</span><span class="nv">deulsaocthuul</span><span class="ss">)</span>

    <span class="nv">deaknaugthein</span> <span class="o">=</span> <span class="nv">roubhaol</span>.<span class="nv">kaizseah</span>.<span class="nv">ControlTipText</span>
    <span class="nv">giakfeiw</span> <span class="o">=</span> <span class="nv">deulsaocthuul</span> <span class="o">+</span> <span class="nv">gooykadheoj</span> <span class="o">+</span> <span class="nv">roubhaol</span>.<span class="nv">paerwagyouqumeid</span>.<span class="nv">ControlTipText</span> <span class="o">+</span> <span class="nv">deaknaugthein</span>
    <span class="nv">queegthaen</span> <span class="o">=</span> <span class="nv">giakfeiw</span> <span class="o">+</span> <span class="nv">roubhaol</span>.<span class="nv">joefwoefcheaw</span>

    <span class="nv">Set</span> <span class="nv">deavjoajsear</span> <span class="o">=</span> <span class="nv">luumlaud</span><span class="ss">(</span><span class="nv">queegthaen</span><span class="ss">)</span>

    <span class="nv">xve</span> <span class="o">=</span> <span class="nv">Array</span> <span class="nv">_</span>
        <span class="ss">(</span><span class="s2">&quot;</span><span class="s">1234444123</span><span class="s2">&quot;</span>, <span class="nv">tiajriokchaoy</span>. <span class="nv">_</span>
        <span class="nv">Create</span><span class="ss">(</span><span class="nv">geulgelquuuj</span>, <span class="nv">kaenhaig</span>, <span class="nv">deavjoajsear</span><span class="ss">)</span>, <span class="s2">&quot;</span><span class="s">9938723</span><span class="s2">&quot;</span><span class="ss">)</span>
<span class="k">End</span> <span class="nv">Function</span>

<span class="nv">Function</span> <span class="nv">juuvzouchmiopxeox</span><span class="ss">(</span><span class="nv">yiajthoavheiw</span><span class="ss">)</span>
    <span class="nv">geutyoeytiestheug</span> <span class="o">=</span> <span class="nv">yiajthoavheiw</span>
    <span class="nv">feaxgeip</span> <span class="o">=</span> <span class="nv">Split</span><span class="ss">(</span><span class="nv">geutyoeytiestheug</span>, <span class="s2">&quot;</span><span class="s">2342772g3&amp;*gs7712ffvs626fq</span><span class="s2">&quot;</span><span class="ss">)</span>

    <span class="nv">jaquhoiqu</span> <span class="o">=</span> <span class="nv">csqw</span> <span class="o">+</span> <span class="nv">Join</span><span class="ss">(</span><span class="nv">feaxgeip</span>, <span class="nv">eihnx</span><span class="ss">)</span>
    <span class="nv">juuvzouchmiopxeox</span> <span class="o">=</span> <span class="nv">jaquhoiqu</span>
<span class="k">End</span> <span class="nv">Function</span>

<span class="nv">Function</span> <span class="nv">geulgelquuuj</span><span class="ss">()</span>
    <span class="nv">sjiqw</span> <span class="o">=</span> <span class="nv">roubhaol</span>.<span class="nv">gaoddaicsauktheb</span>.<span class="nv">Pages</span><span class="ss">(</span><span class="mi">10</span> <span class="o">/</span> <span class="mi">10</span><span class="ss">)</span>.<span class="nv">ControlTipText</span>
    <span class="nv">geulgelquuuj</span> <span class="o">=</span> <span class="nv">juuvzouchmiopxeox</span><span class="ss">(</span><span class="nv">sjiqw</span><span class="ss">)</span>
<span class="k">End</span> <span class="nv">Function</span>

<span class="nv">Function</span> <span class="nv">luumlaud</span><span class="ss">(</span><span class="nv">zeolkaepxoag</span><span class="ss">)</span>
    <span class="nv">Set</span> <span class="nv">luumlaud</span> <span class="o">=</span> <span class="nv">CreateObject</span><span class="ss">(</span><span class="nv">zeolkaepxoag</span><span class="ss">)</span>
    <span class="nv">Dim</span> <span class="nv">vPu</span> <span class="nv">As</span> <span class="nv">String</span>
    <span class="nv">vPu</span> <span class="o">=</span> <span class="nv">Replace</span>$<span class="ss">(</span><span class="s2">&quot;</span><span class="s">BenqV1�igVwifwdQq</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">BenqV1�i</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">on5�</span><span class="s2">&quot;</span><span class="ss">)</span>
        <span class="nv">luumlaud</span> <span class="nv">_</span>
        . <span class="nv">_</span>
        <span class="nv">showwindow</span> <span class="o">=</span> <span class="ss">(</span><span class="nv">mujgoiy</span> <span class="o">+</span> <span class="nv">jioyseertioch</span><span class="ss">)</span> <span class="o">+</span> <span class="ss">(</span><span class="nv">neivberziok</span> <span class="o">+</span> <span class="nv">xuajroegquoudcaij</span><span class="ss">)</span>
<span class="k">End</span> <span class="nv">Function</span>
</code></pre></div>

<p>As you can see above, the code is shorter. It's also a little easier to understand. Only a little though, we still need to step through the code carefully to have a better grasp of what it is doing.</p>
<p>Let's take on the next line:</p>
<div class="codehilite"><pre><span></span><code>haothkoebtheil = &quot;2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fqw2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fqin2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fqm2342772g3&amp;*gs7712ffvs626fqgm2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fqt2342772g3&amp;*gs7712ffvs626fq&quot; + gooykadheoj + &quot;2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fq:w2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fqin2342772g3&amp;*gs7712ffvs626fq322342772g3&amp;*gs7712ffvs626fq_2342772g3&amp;*gs7712ffvs626fq&quot; + roubhaol.joefwoefcheaw + &quot;2342772g3&amp;*gs7712ffvs626fqr2342772g3&amp;*gs7712ffvs626fqo2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fqc2342772g3&amp;*gs7712ffvs626fqes2342772g3&amp;*gs7712ffvs626fqs2342772g3&amp;*gs7712ffvs626fq&quot;
</code></pre></div>

<p>If we look at the string carefully we would notice that a set of strings is concatenated with two variables. These variables are <code>gooykadheoj</code> and <code>roubhaol.joefwoefcheaw</code>. We already know the value of <code>gooykadheoj</code>. So what's the value of <code>roubhaol.joefwoefcheaw</code>?</p>
<p>I got this value by going back to Visual Basic Editor and selelecting <code>joefwoefcheaw</code>. The value we need is listed under <code>Text</code>.</p>
<p><img alt="maldoc101-writeup-02" src="../images/maldoc101-writeup-02.png" /></p>
<p>Substituting the values <code>s</code> and <code>P</code> I got the following:</p>
<div class="codehilite"><pre><span></span><code>haothkoebtheil = &quot;2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fqw2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fqin2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fqm2342772g3&amp;*gs7712ffvs626fqgm2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fqt2342772g3&amp;*gs7712ffvs626fqs2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fq:w2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fqin2342772g3&amp;*gs7712ffvs626fq322342772g3&amp;*gs7712ffvs626fq_2342772g3&amp;*gs7712ffvs626fqP2342772g3&amp;*gs7712ffvs626fqr2342772g3&amp;*gs7712ffvs626fqo2342772g3&amp;*gs7712ffvs626fq2342772g3&amp;*gs7712ffvs626fqc2342772g3&amp;*gs7712ffvs626fqes2342772g3&amp;*gs7712ffvs626fqs2342772g3&amp;*gs7712ffvs626fq&quot;
</code></pre></div>

<p>It still doesn't clear up the gibberish, but at least it's now one big string. This same string is then passed as a parameter to function <code>juuvzouchmiopxeox</code>. </p>
<div class="codehilite"><pre><span></span><code>deulsaocthuul = juuvzouchmiopxeox(haothkoebtheil)
</code></pre></div>

<p>Let's look at the code inside <code>juuvzouchmiopxeox</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="nv">Function</span> <span class="nv">juuvzouchmiopxeox</span><span class="ss">(</span><span class="nv">yiajthoavheiw</span><span class="ss">)</span>
    <span class="nv">geutyoeytiestheug</span> <span class="o">=</span> <span class="nv">yiajthoavheiw</span>
    <span class="nv">feaxgeip</span> <span class="o">=</span> <span class="nv">Split</span><span class="ss">(</span><span class="nv">geutyoeytiestheug</span>, <span class="s2">&quot;</span><span class="s">2342772g3&amp;*gs7712ffvs626fq</span><span class="s2">&quot;</span><span class="ss">)</span>

    <span class="nv">jaquhoiqu</span> <span class="o">=</span> <span class="nv">csqw</span> <span class="o">+</span> <span class="nv">Join</span><span class="ss">(</span><span class="nv">feaxgeip</span>, <span class="nv">eihnx</span><span class="ss">)</span>
    <span class="nv">juuvzouchmiopxeox</span> <span class="o">=</span> <span class="nv">jaquhoiqu</span>
<span class="k">End</span> <span class="nv">Function</span>
</code></pre></div>

<p>Following the code we could see that the passed string is splitted using the call to the function <code>Split</code> with the substring <code>2342772g3&amp;*gs7712ffvs626fq</code>. This simply means that the substring is removed from the input string. The result of <code>Split</code> is then joined into one string using <code>Join</code>. There are the variables <code>csqw</code> and <code>eihnx</code>, they don't alter the string as these variables are empty. </p>
<p>At the end of this function the value of the passed string is now:</p>
<div class="codehilite"><pre><span></span><code><span class="n">winmgmts</span><span class="o">:</span><span class="n">win32_Process</span>
</code></pre></div>

<p>Aha! Something that is not gibberish for a change!</p>
<p>Going back to the caller function, the result of <code>juuvzouchmiopxeox</code> is saved to <code>deulsaocthuul</code>.</p>
<div class="codehilite"><pre><span></span><code>    deulsaocthuul = juuvzouchmiopxeox(haothkoebtheil)

    Set tiajriokchaoy = CreateObject(deulsaocthuul)
</code></pre></div>

<p>After that an object is created out of <code>deaulsaocthuul</code>, which we know contains <code>winmgmts:win32_Process</code>. </p>
<p>Looking at <a href="https://docs.microsoft.com/en-us/windows/win32/cimwin32prov/win32-process">the microsoft docs</a> I find out that <code>The Win32_Process WMI class represents a process on an operating system.</code>. Interesting.</p>
<h2 id="taking-a-step-back">Taking a step back</h2>
<p>At this point there are already a number of questions that we could answer based on what we've done so far. Some are not yet answerable at the moment, however, so nothing left to do but to push forward. But that will be for the next part of this two part series.</p>
<p>Until then, I'm taking a step back as I marvel at my progress. It wouldn't take long until all the pieces would fall into place.</p>
          <!-- <a class="full-article-link pull-right" rel="full-article" href="../maldoc101-writeup-part-1.html">Read on →</a> -->
      </article>
    </div>
  </div>
  <!-- CONTENT GOES HERE -->
  <div class="row">
    <div class="col-md-8 col-md-offset-2">
      <article>
        <h1><a href="../ioli-crackme-0x02.html">IOLI Crackme 0x02</a></h1>
	<div class="meta">
          <time datetime="2021-03-06T10:34:00+08:00">March 06, 2021</time>
          in <span class="categories">
            <a href="../tag/re.html">re</a>,            <a href="../tag/crackme.html">crackme</a>          </span>
	</div>
        <p><p>I am continuing my reverse engineering review by tackling the <em>IOLI crackmes</em> by <a href="https://twitter.com/pof">@pof</a>. These are beginner friendly challenges that is perfect for newbies or for those who want to review the basics like me. Check out my writeups for <a href="../ioli-crackme-0x00.html">0x00</a> and <a href="../ioli-crackme-0x01.html">0x01</a>.</p>
<h1 id="getting-the-password">Getting the password</h1>
<p>After the first two challenges I kinda know what to expect already so I skipped running the program and immediately loaded it in IDA.</p>
<p><img alt="ioli-crackme-0x02-01" src="../images/ioli-crackme-0x02-01.png" /></p>
<p>So the lines leading to the comparison command now looks more complicated than before. We could easily see that there are some computations that happens thanks to the presence of <code>add</code> and <code>imul</code>. Before those, we have two values (<code>5Ah</code> and <code>1ECh</code>) which we can easily guess are the values that will be worked on by these arithmetic functions.</p>
<p>So going through the lines sequentially we can see that the two numbers are first added with <code>add [eax], edx</code>. Which results in a value of <code>246h</code>.</p>
<p>After that we see the line <code>imul eax, [ebp+var_8]</code>, which if you follow the sequence closely effectively multiplies <code>246h</code> by itself, resulting in a value of <code>52B24h</code>.</p>
<p>Convert <code>52B24h</code> to decimal equates to <code>338724</code>, which is unsprisingly the password that we need.</p>
<p><img alt="ioli-crackme-0x02-02" src="../images/ioli-crackme-0x02-02.png" /></p>
<h1 id="confirming-via-dynamic-analysis">Confirming via dynamic analysis</h1>
<p>What we did above is that we used static analysis to inspect the program line by line to determine the final computed password value. Let's use dynamic analysis and step through the code to see how our data is manipulated in memory during this process.</p>
<p>Let's set a breakpoint immediately after the initial two values are loaded into memory.</p>
<p><img alt="ioli-crackme-0x02-03" src="../images/ioli-crackme-0x02-03.png" /></p>
<p>If we look at the memory locations we would see the following:</p>
<p><img alt="ioli-crackme-0x02-04" src="../images/ioli-crackme-0x02-04.png" /></p>
<p><code>epb+var_8</code> points to <code>28FF40</code> which now contains <code>5Ah</code></p>
<p><code>ebp+var_C</code> points to <code>28FF3C</code> which now contains <code>1ECh</code></p>
<p>Stepping through the code and checking the memory location after <code>add [eax], edx</code> shows that the result <code>246h</code> is saved at memory location <code>28FF40</code>.</p>
<p><img alt="ioli-crackme-0x02-05" src="../images/ioli-crackme-0x02-05.png" /></p>
<p>Then after <code>imul eax, [ebp+var_8]</code> we see that eax now holds the value of <code>52B24h</code>, confirming the final computed value that we had from our static analysis.</p>
<p><img alt="ioli-crackme-0x02-06" src="../images/ioli-crackme-0x02-06.png" /></p>
<h1 id="patching-the-executables">Patching the executables</h1>
<p>Patching the executable is actually the same process as <a href="../ioli-crackme-0x00.html">my writeup for 0x00</a>.</p>
<h1 id="on-to-the-next-challenge">On to the next challenge...</h1>
<p>While the challenge is still easy, we can see that the complexity is slowly ramping up from previous challenges. We also took the time to confirm the result of our static analysis by debugging and stepping through the code. This is a good practice for me to familiarize myself with IDA, which I hope I could use in future challenges.</p>
          <!-- <a class="full-article-link pull-right" rel="full-article" href="../ioli-crackme-0x02.html">Read on →</a> -->
      </article>
    </div>
  </div>
  <!-- CONTENT GOES HERE -->
  <div class="row">
    <div class="col-md-8 col-md-offset-2">
      <article>
        <h1><a href="../introducing-shcode2exe.html">Introducing shcode2exe</a></h1>
	<div class="meta">
          <time datetime="2021-02-26T07:34:00+08:00">February 26, 2021</time>
          in <span class="categories">
            <a href="../tag/re.html">re</a>,            <a href="../tag/tools.html">tools</a>,            <a href="../tag/malware_analysis.html">malware_analysis</a>          </span>
	</div>
        <p><p><strong>[Edit: shcode2exe is <a href="https://docs.remnux.org/discover-the-tools/dynamically+reverse-engineer+code/shellcode#shcode-2-exe">now part of Remnux</a>]</strong></p>
<p>I've been playing around with <a href="https://remnux.org/">Remnux</a> and encountered a problem trying to get one of the tools to run properly. The tool is <a href="https://github.com/repnz/shellcode2exe">shellcode2exe</a>, it is used to compile binary shellcode to a file so it can easily be debugged by a debugger.</p>
<p>When I checked out the code, I was surprised to find out how simple it is. Basically, what happens is that the inputted shellcode is added to a barebones assembly file using the <code>incbin</code> assembly instruction. From there, the file is then automatically compiled and linked.</p>
<p>One big problem with the tool is that it needs to use <a href="https://www.winehq.org/">Wine</a> if it needs to run on Linux. I don't want such a huge dependency especially for my own malware analysis lab so I decided to write my own version which have led to the creation of <code>shcode2exe</code>.</p>
<h2 id="shcode2exe">shcode2exe</h2>
<p>While similar in functionality with the original tool, the biggest improvement I made is that it it does not depend on Wine along with other features as listed below:</p>
<ul>
<li>Can accept a shellcode blob or string (String format <code>\x5e\x31</code>)</li>
<li>Can target both 32bit or 64bit Windows architecture. </li>
<li>Cross platform. Works on Linux or Windows.</li>
<li>No dependency on Wine when running on Linux</li>
<li>Tested working with Python v3.3 and above</li>
<li>Tested working on Windows 7 (Non SP1) and above</li>
</ul>
<h2 id="usage">Usage</h2>
<p>Here's the help message for the tool:</p>
<div class="codehilite"><pre><span></span><code><span class="go">usage: shcode2exe.py [-h] [-o OUTPUT] [-s] [-a {32,64}] input</span>

<span class="go">Compile a binary shellcode blob into an exe file. Can target both 32bit or 64bit architecture.</span>

<span class="go">positional arguments:</span>
<span class="go">  input                 The input file containing the shellcode.</span>

<span class="go">optional arguments:</span>
<span class="go">  -h, --help            show this help message and exit</span>
<span class="go">  -o OUTPUT, --output OUTPUT</span>
<span class="go">                        Set output exe file.</span>
<span class="go">  -s, --string          Set if input file contains shellcode in string format.</span>
<span class="go">  -a {32,64}, --architecture {32,64}</span>
<span class="go">                        The windows architecture to use</span>
</code></pre></div>

<p>Here's how to load a file with shellcode in the format of a string</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>cat test.txt
<span class="go">\x5e\x31\xc0\xb0\x24\xcd\x80\xb0\x24\xcd\x80\xb0\x58\xbb\xad\xde\xe1\xfe\xb9\x69\x19\x12\x28\xba\x67\x45\x23\x01\xcd\x80</span>
<span class="gp">$ </span>./shcode2exe.py -s -o test-string.exe test.bin
</code></pre></div>

<p>Load a file with shellcode in the format of a blob</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>./shcode2exe.py -o test-blob.exe test.bin
</code></pre></div>

<p>Use 64 bit architecture for the output (32 bit is the default)</p>
<div class="codehilite"><pre><span></span><code><span class="gp">$ </span>./shcode2exe.py -o test-blob.exe -a <span class="m">64</span> test.bin
<span class="gp">$ </span>file test-blob.exe
<span class="go">test-blob.exe: PE32+ executable (console) x86-64 (stripped to external PDB), for MS Windows</span>
</code></pre></div>

<h2 id="next-steps">Next steps</h2>
<p>I decided to reach out to the people behind Remnux to ask if they could consider my tool as a replacement on their platform. It would be great if they would, but it's okay too if they don't, I made it for my own use anyway. (Update 2021-02-07: It's now <a href="https://github.com/REMnux/salt-states/issues/169">under review</a>)</p>
<p>For more information about the tool and it's code, go to <a href="https://github.com/accidentalrebel/shcode2exe">it's Github page</a>. If you have any comments or suggestions on how to improve it, feel free to tell me via Github issues or dm me at <a href="https://twitter.com/accidentalrebel">@accidentalrebel</a>.</p>
          <!-- <a class="full-article-link pull-right" rel="full-article" href="../introducing-shcode2exe.html">Read on →</a> -->
      </article>
    </div>
  </div>
  <!-- CONTENT GOES HERE -->
  <div class="row">
    <div class="col-md-8 col-md-offset-2">
      <article>
        <h1><a href="../ioli-crackme-0x01.html">IOLI Crackme 0x01</a></h1>
	<div class="meta">
          <time datetime="2021-02-20T17:34:00+08:00">February 20, 2021</time>
          in <span class="categories">
            <a href="../tag/re.html">re</a>,            <a href="../tag/crackme.html">crackme</a>          </span>
	</div>
        <p><p>I am continuing my reverse engineering review by tackling the <em>IOLI crackmes</em> by <a href="https://twitter.com/pof">@pof</a>. These are beginner friendly challenges that is perfect for newbies or for those who want to review the basics like me. Check out my writeup for 0x00 <a href="../ioli-crackme-0x00.html">here</a>.</p>
<h1 id="getting-the-password">Getting the password</h1>
<p>Of course, the first thing we do is run the program.</p>
<p><img alt="ioli-crackme-0x01-01" src="../images/ioli-crackme-0x01-01.png" /></p>
<p>Just like last time, we opened up the program in IDA and focused on the part of the code that does the comparing of passwords.</p>
<p><img alt="ioli-crackme-0x01-02" src="../images/ioli-crackme-0x01-02.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="nf">cmp</span> <span class="p">[</span><span class="no">ebp</span><span class="err">+</span><span class="no">var_4</span><span class="p">],</span> <span class="mi">149</span><span class="no">Ah</span>
<span class="nf">jz</span> <span class="no">short</span> <span class="no">loc_40137c</span>
</code></pre></div>

<p>This seems easy enough. </p>
<p>Initially I entered <code>149A</code> as the password but this turned out to be incorrect. The reason for this is because <code>scanf</code> was passed a format of <em>"%d"</em>.</p>
<div class="codehilite"><pre><span></span><code><span class="nf">mov</span> <span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">18</span><span class="no">h</span><span class="err">+</span><span class="no">Format</span><span class="p">],</span> <span class="no">offset</span> <span class="no">aD</span> <span class="c1">; &quot;%d&quot;</span>
<span class="nf">call</span> <span class="no">_scanf</span>
</code></pre></div>

<p>This means that the input it expects is actually a decimal integer. So converting <code>149A</code> to decimal results in <code>5274</code>, which is the correct password.</p>
<p><img alt="ioli-crackme-0x01-03" src="../images/ioli-crackme-0x01-03.png" /></p>
<h1 id="patching-the-executables">Patching the executables</h1>
<p>Patching the executable is actually the same process as <a href="../ioli-crackme-0x00.html">my writeup for 0x00</a>.</p>
<h1 id="passing-arguments-to-functions">Passing arguments to functions</h1>
<p>Since the crackme was cracked relatively quickly I want to review and highlight how arguments are passed to functions. </p>
<p>The format of the <code>scanf</code> function in C is like so:</p>
<div class="codehilite"><pre><span></span><code><span class="kt">int</span> <span class="nf">scanf</span> <span class="p">(</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">format</span><span class="p">,</span> <span class="p">...</span> <span class="p">);</span>
</code></pre></div>

<p>Here's an example of how it is used:</p>
<div class="codehilite"><pre><span></span><code><span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<span class="n">scanf</span> <span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">i</span><span class="p">);</span>
</code></pre></div>

<p>If we look at the 0x01 program we could see how the arguments are passed to the <em>_scanf</em> function by placing the data to send on top of the stack.</p>
<div class="codehilite"><pre><span></span><code><span class="nf">lea</span> <span class="no">eax</span><span class="p">,</span> <span class="p">[</span><span class="no">ebp</span><span class="err">+</span><span class="no">var_4</span><span class="p">]</span>
<span class="nf">mov</span> <span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">18</span><span class="no">h</span><span class="err">+</span><span class="no">var_14</span><span class="p">],</span> <span class="no">eax</span>
<span class="nf">mov</span> <span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">18</span><span class="no">h</span><span class="err">+</span><span class="no">Format</span><span class="p">],</span> <span class="no">offset</span> <span class="no">aD</span><span class="c1">;  &quot;%d&quot;</span>
<span class="nf">call</span> <span class="no">_scanf</span>
</code></pre></div>

<p><code>lea eax, [ebp+var_4]</code> gets the address of <em>var_4</em>, this is the memory location where scanf would put the inputted data. This is then added to the stack with <code>mov [esp+18h+var_14]</code>.</p>
<p><code>offset aD</code> gets the address of <code>aD</code> which contains the string <em>"%d"</em>. This is the <em>format</em> parameter that <em>scanf</em> expects. This is then added to the stack with <code>mov [esp+18h+Format]</code>.</p>
<p>With the two parameters added to the stack, it can now be used by the <em>scanf</em> function when <code>call _scanf</code> is executed.</p>
<p>I'm not sure if I was able to explain that properly. At the very least, you should have been able to have a basic idea of how variables are passed to functions. Take note, however, that there are other calling conventions for functions which meants that the passing of arguments can also differ.</p>
<h1 id="on-to-the-next-challenge">On to the next challenge...</h1>
<p>This is the second challenge out of 10 in the IOLI series of challenges. So far the challenges are still very easy, which is fine because it's still good for practice. I look forward to the next one.</p>
          <!-- <a class="full-article-link pull-right" rel="full-article" href="../ioli-crackme-0x01.html">Read on →</a> -->
      </article>
    </div>
  </div>
  <!-- CONTENT GOES HERE -->
  <div class="row">
    <div class="col-md-8 col-md-offset-2">
      <article>
        <h1><a href="../ioli-crackme-0x00.html">IOLI Crackme 0x00</a></h1>
	<div class="meta">
          <time datetime="2021-02-16T21:55:00+08:00">February 16, 2021</time>
          in <span class="categories">
            <a href="../tag/re.html">re</a>,            <a href="../tag/crackme.html">crackme</a>          </span>
	</div>
        <p><p>I am re-familiarizing myself with reverse engineering again by going through some simple crackme challenges. This one is called the IOLI Crackmes by pof. The goal is to find the correct password and also to patch it so that it can accept any input and still show that it's correct.</p>
<h2 id="getting-the-password">Getting the password</h2>
<p>Running the program shows a password prompt. </p>
<p><img alt="ioli-crackme-0x00-03" src="../images/ioli-crackme-0x00-03.png" /></p>
<p>Of course, randomly entering passwords is going to be a waste of time so I opened up IDA to look at its code.</p>
<p>I knew that whatever password I enter in the program would be checked against the actual password. This is the part of the program that I should focus on so I scanned the code and found this:</p>
<p><img alt="ioli-crackme-0x00-02" src="../images/ioli-crackme-0x00-02.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="nf">mov</span> <span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">38</span><span class="no">h</span><span class="err">+</span><span class="no">Str2</span><span class="p">],</span> <span class="no">offset</span> <span class="no">Str2</span><span class="c1">; &quot;250382&quot;</span>
<span class="nf">mov</span> <span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">38</span><span class="no">h</span><span class="err">+</span><span class="no">Format</span><span class="p">],</span> <span class="no">eax</span><span class="c1">; </span>
<span class="nf">call</span> <span class="no">_strcmp</span>
</code></pre></div>

<p>And just from these few lines alone I already knew what the password is. IDA Pro was helpful enough to add a comment that <code>offset Str2</code> equates to <code>250382</code>. Surely enough, this number was the password.</p>
<p><img alt="ioli-crackme-0x00-04" src="../images/ioli-crackme-0x00-04.png" /></p>
<h2 id="patching-the-executable">Patching the executable</h2>
<p>The next part of the challenge is to patch the executable so that it can accept any input and would still allow us through.</p>
<p>Looking at the graph view, we want the program to always go to the node on the right which has the "Password OK" message. </p>
<p><img alt="ioli-crackme-0x00-05" src="../images/ioli-crackme-0x00-05.png" /></p>
<p>The line that we could change to allow us to do this would be this one:</p>
<div class="codehilite"><pre><span></span><code><span class="nf">jz</span> <span class="no">short</span> <span class="no">loc_40138A</span>
</code></pre></div>

<p>The <code>jz</code> can be changed to a <code>jmp</code> command by changing the op code. Opening up the "Patch Bytes" window while the line is highlighted would show us this:</p>
<p><img alt="ioli-crackme-0x00-06" src="../images/ioli-crackme-0x00-06.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="mf">74</span> <span class="mf">0</span><span class="n">E</span> <span class="n">C7</span> <span class="mf">04</span> <span class="mf">24</span> <span class="mf">2</span><span class="n">E</span> <span class="mf">40</span> <span class="mf">40</span> <span class="mf">00</span> <span class="n">E8</span> <span class="n">A8</span> <span class="mf">19</span> <span class="mf">00</span> <span class="mf">00</span> <span class="n">EB</span> <span class="mf">0</span><span class="n">C</span>
</code></pre></div>

<p>The opcode related to <code>jz short loc_40138A</code> is the first two btyes <code>74 0E</code>. <code>74</code> is the "Jump short if equal" opcode and <code>0E</code> is the relative jump distance. Changing <code>74</code> to <code>EB</code> converts it to the "Jump" opcode effectively making the line <code>jmp short loc_40138A</code>.</p>
<p><img alt="ioli-crackme-0x00-07" src="../images/ioli-crackme-0x00-07.png" /></p>
<p>After saving, IDA will automatically upgrade the graph. It will now show us that the flow of the program now jumps to the right node directly.</p>
<p><img alt="ioli-crackme-0x00-08" src="../images/ioli-crackme-0x00-08.png" /></p>
<p>All that is left to do is to patch the executable via "Edit &gt; Patch Program &gt; Apply patches to input file..." and run the program. From here, any entered password would automatically get accepted.</p>
<p><img alt="ioli-crackme-0x00-09" src="../images/ioli-crackme-0x00-09.png" /></p>
<h2 id="on-to-the-next-challenge">On to the next challenge...</h2>
<p>This is the first out of the 10 challenges from this set. Since this is the first one, it is only natural for it to be very easy. It's still a good refresher for me especially since the last time I did any reversing was from a few years ago. I look forward to the next challenges, I do hope that they would ramp up in difficulty and also teach me new things for me to improve.</p>
          <!-- <a class="full-article-link pull-right" rel="full-article" href="../ioli-crackme-0x00.html">Read on →</a> -->
      </article>
    </div>
  </div>
  <!-- CONTENT GOES HERE -->
  <div class="row">
    <div class="col-md-8 col-md-offset-2">
      <article>
        <h1><a href="../hunt-the-kingdom-ctf-challenge.html">Hunt the Kingdom CTF Challenge</a></h1>
	<div class="meta">
          <time datetime="2020-10-05T11:13:00+08:00">October 05, 2020</time>
          in <span class="categories">
            <a href="../tag/ctf.html">ctf</a>,            <a href="../tag/cybersecurity.html">cybersecurity</a>          </span>
	</div>
        <p><blockquote>
<p>TLDR: Participated in a blue team CTF, had a lot of fun, looking forward for more</p>
</blockquote>
<p>Yesterday I participated in the <a href="https://www.facebook.com/guidemtraining">GuideM "Hunt the Kingdom" CTF challenge</a>. It served as the final activity at the end of the <em>"Cyber Defense and Threat Hunting"</em> course.</p>
<p>I was looking forward to this CTF, especially after my awesome experience with the <a href="../covidscammers-writeup--defcon-rtv-ctf.html">Red Team Village CTF at Defcon</a>. This one is centered on the Blue Team side, and I was curious as to how it will play out.</p>
<h2 id="the-preparation">The Preparation</h2>
<p>I took one whole day to study and prepare. I went through all our slides and have written down the important concepts and commands to an org file. This is important because I wanted them to be easily searchable, which helped a lot during the challenge.</p>
<p>I also did research about the Hunt the Kingdom challenge itself. There weren't much information online about it but there were <a href="https://www.facebook.com/guidemtraining/photos/a.142012317191141/229536238438748/">some social media posts</a> that contained screenshots on how the challenge looked like. These gave me a lot of information on what to expect.</p>
<p><img alt="hunt-the-kingdom-ctf-challenge-01" src="../images/hunt-the-kingdom-ctf-challenge-01.jpg" /></p>
<div class="codehilite"><pre><span></span><code>It&#39;s OSINT in practice :P
</code></pre></div>

<p>For example, with the screenshot above I learned how the UI looked like, that there were categories that we could switch to, leaderboards, how a question is structured, and that "areas" on the map can get added, enabled, and disabled during the game. The last part is particularly important as it means that not all questions are available from the start and some can get disabled during the game.</p>
<p>Thanks to the above research I felt confident that I could hit the ground running as soon as the game started. I picked my name (AccidentalRebel, of course) and my emblem and I was ready for the hunt.</p>
<p><img alt="hunt-the-kingdom-ctf-challenge-02" src="../images/hunt-the-kingdom-ctf-challenge-02.png" /></p>
<div class="codehilite"><pre><span></span><code>Yes, that&#39;s the blue tank from Advance Wars, because I&#39;m part of the &quot;blue team&quot;.
</code></pre></div>

<h2 id="the-hunt">The Hunt</h2>
<p>When the hunt started my approach was to focus on the easy problems first. Getting them out of the way early would allow me to rack up points and just focus on the hard ones afterwards. This did the trick and I was able to maintain an early lead.</p>
<p>During the mid-game my computer hanged from all the switching between VMs (There were 3 VMs that we needed to use to solve the problems). <em>Note to self: get a beefier PC</em>. I got a bit frustrated by this but decided that instead of waiting for Windows to boot I could use the time to take a break and got lunch. </p>
<p><img alt="hunt-the-kingdom-ctf-challenge-03" src="../images/hunt-the-kingdom-ctf-challenge-03.53" /></p>
<p>I came back to the game all full and refreshed, but sadly, I have already lost my lead. I felt a bit disappointed by this but I continued to push through. I removed the leaderboards to minimize distractions which helped. No need to pressure myself, I told myself. Although, I admit that I did peek from time to time.</p>
<p>With the renewed focus I was able to keep my standing in the top 3. The leader of the pack during the end-game was <em>BoyHack3r</em>, a worthy opponent who was always a few points ahead of me. </p>
<p>There was one question that has a lot of points that only has one solve. I knew that if I could get that it would give me enough points to snatch back 1st place. It wasn't an easy problem though so I changed my approach by slowing down which helped me understand the questions better. A few minutes later I was back at first place.</p>
<p>I've never done a celebratory fist pump before, this was the first time.</p>
<h2 id="the-final-minutes">The Final Minutes</h2>
<p>I was able to maintain first place position by continuously answering questions until I was left with just four questions. These four are problems that no one has solved yet. The activity on the leaderboards have lessened which I took to mean that the others were stuck like me. I was at 13740 points, BoyHack3r at 13590, and Overwatch at 13460. If any of them managed to solve just one out of these four problems then they'll easily overtake me.</p>
<p>I wasn't going to let that happen though. At 5 minutes left I continued solving the one that I had the most progress with. But it wasn't enough and I ran out of time. The others didn't get their lucky break either which finally cemented the scores on the boards.</p>
<p><img alt="hunt-the-kingdom-ctf-challenge-04" src="../images/hunt-the-kingdom-ctf-challenge-04.PNG" /></p>
<p>After 6 hours of back-breaking hunting I was finally able to breathe a sigh of relief. </p>
<h2 id="the-end">The End</h2>
<p>I rarely engage in any competitive activity so my competitive side rarely comes out. This CTF definitely brought it out and gave me the push to take the challenge seriously. I didn't do it for the prizes though. I did it because I wanted to prove to myself that I have what it takes, especially since I don't have a formal background in CyberSecurity. While a CTF is not an accurate qualification of being part of a blue team, it does show a participant's ability to work and solve problems under pressure.</p>
<p>I want to give a shoutout to <a href="https://www.facebook.com/guidemtraining">GuideM</a> for guiding us throughout the course and for the extremely fun CTF challenge. Also to <em>BoyHack3r</em>, <em>Overwatch</em>, and <em>:]</em> for making me sweat bullets.</p>
<p>This is another big step for me into the world of cybersecurity and I do hope I could learn more and improve. I look forward to the next CTF!</p>
          <!-- <a class="full-article-link pull-right" rel="full-article" href="../hunt-the-kingdom-ctf-challenge.html">Read on →</a> -->
      </article>
    </div>
  </div>
  <!-- CONTENT GOES HERE -->
  <div class="row">
    <div class="col-md-8 col-md-offset-2">
      <article>
        <h1><a href="../my-experience-manufacturing-printed-circuit-boards.html">My experience with manufacturing printed circuit boards</a></h1>
	<div class="meta">
          <time datetime="2020-10-01T07:19:00+08:00">October 01, 2020</time>
          in <span class="categories">
            <a href="../tag/pcbs.html">pcbs</a>,            <a href="../tag/electronics.html">electronics</a>          </span>
	</div>
        <p><p>I've done a lot of electronics projects already, all of them were painstakingly hand-soldered on a perfboard. I actually like this approach for quick prototyping, and plus, I've also grown fond of how "raw" it looks like. In spite of this, I've always been curious and interested in having my own printed PCB. I remember designing one for my <a href="https://hackaday.io/project/164144-tiro-vibrating-watch/log/161430-current-state-and-next-steps">TIRO vibrating watch</a> but I never pushed through with it because I wasn't confident with what I've made.</p>
<p><img alt="my-experience-manufacturing-printed-circuit-boards-01" src="../images/my-experience-manufacturing-printed-circuit-boards-01.jpg" /></p>
<div class="codehilite"><pre><span></span><code>I really like the raw, almost electronic-punk look of my work
</code></pre></div>

<p>A couple of months ago I got an email from <a href="https://www.pcbway.com/">PCBWay</a> asking if I was interested in trying out their PCB manufacturing service. The email from PCBWay re-ignited this interest in having a PCB made. The problem is I didn't have a PCB design that I built myself that I knew was going to work. My best option was the "ESPBoy project".</p>
<p>The <a href="https://hackaday.io/project/164830-espboy-the-ultimate-multi-gadget">ESPBoy</a> is a project by <a href="https://hackaday.io/ESPboy.edu">RomanS</a> that is touted to be the ultimate multi-gadget. RomanS sent me a kit a long time ago (Thank's again, RomanS). I have assembled and <a href="https://www.youtube.com/watch?v=GIrp5Vpr2Ns&amp;feature=emb_title">made a tutorial video</a> for it which means that I know that it works and have a very good idea of how it is laid out.</p>
<p>With that decided, having the PCB made was a very easy and quick process. I just uploaded the gerber file on the PCBWay website, waited for the review of the PCB to be finished, and in a few hours I clicked the submit button and it was off to the printers.</p>
<p>Fast forward a few weeks later and the package with the printed pcbs arrived.</p>
<p><img alt="my-experience-manufacturing-printed-circuit-boards-02" src="../images/my-experience-manufacturing-printed-circuit-boards-02.jpg" /></p>
<div class="codehilite"><pre><span></span><code>And yes, I changed the color to red just so they would look different.
</code></pre></div>

<p>I must say that I am very impressed with the quality of the PCBs. The material feels really solid and the lines so fine and accurate. I've seen and held PCB etchings before, and this is like lightyears ahead in terms of quality. The same can be said with my hand soldered perfboards, of course.</p>
<p>Sadly, these PCBs have been sitting in storage because I haven't found the time due to the baby. Thankfully, my schedule is slowly opening up recently and I plan to build one ESPBoy in the next coming weeks. I plan to remove the parts from the old one and put it on this. This newer PCB design has new features like the ability to connect to an app store (yeah, seriously) and I'm really curious to try it out.</p>
<p>I also might consider having another PCB made, but this time with my own design. I'm thinking I might go ahead and have my TIRO watch made, or maybe something even simpler. We'll see.</p>
          <!-- <a class="full-article-link pull-right" rel="full-article" href="../my-experience-manufacturing-printed-circuit-boards.html">Read on →</a> -->
      </article>
    </div>
  </div>
  <!-- CONTENT GOES HERE -->
  <div class="row">
    <div class="col-md-8 col-md-offset-2">
      <article>
        <h1><a href="../covidscammers-writeup--defcon-rtv-ctf.html">CovidScammers writeup (Defcon RTV CTF)</a></h1>
	<div class="meta">
          <time datetime="2020-08-13T16:58:00+08:00">August 13, 2020</time>
          in <span class="categories">
            <a href="../tag/ctf.html">ctf</a>,            <a href="../tag/writeup.html">writeup</a>,            <a href="../tag/malware_analysis.html">malware_analysis</a>,            <a href="../tag/defcon.html">defcon</a>          </span>
	</div>
        <p><p>I joined the <a href="https://ctf.threatsims.com">Defcon Red Team Village CTF</a> because I was curious about it and I wanted to test out the skills that I have gained playing with CTF sites like <a href="https://overthewire.org/wargames/">overthewire.org</a> and <a href="https://www.vulnhub.com/">vulnhub</a>. I knew that the challenges won't be easy, but thankfully, I was able to join up with other newbies who were willing to give it a go and learn with each other.</p>
<p>Unfortunately, I fell asleep just before the CTF started and when I woke up all the easy challenges were already solved by my team members. There was one easy challenge that was still open on the CovidScammers category, so I quickly got started to solving that.</p>
<h2 id="free-flag-and-binary-1-point">Free Flag (and binary) [1 point]</h2>
<blockquote>
<p>You've been contacted by a high-end but morally ambiguous finance company (unhackable-bitcoin-wallet.com) to investigate a data breach. The box in question is a mail server in their internal network, a sample of the malware found on the system has been pulled and given to you. Your task, should you choose to accept it, is to reverse-engineer the sample and locate, fuzz and exploit the C2 server, and then hack-back to learn about the malicious actor and recover the stolen documents.
Look for the free flag. Get on the scoreboard!</p>
</blockquote>
<p>I admit that in a hurry to get points I did not properly read the description of the challenge. I understood that I'll be downloading and reverse-engineering something. But it did not register on my mind that it's actually malware.</p>
<p>The download was a binary that doesn't do anything when run. My first instict was to use <code>strings</code> to look for the flag, which turned out to be correct.</p>
<p><img alt="giving-malware-to-a-noob--defcon-rtv-ctf-covidscammers-writeup-01" src="../images/giving-malware-to-a-noob--defcon-rtv-ctf-covidscammers-writeup-01.png" /></p>
<p>The flag is: <code>TS{freeFlagLookAtMe}</code>.</p>
<p>Unfortunately, this challenge was already solved by a team member so I did not get the free flag. The second one, is still open though.</p>
<h2 id="syscalls-5-points">Syscalls [5 points]</h2>
<blockquote>
<p>What syscall is hindering your dynamic analysis? Flag is just the syscall, no brackets or anything.</p>
</blockquote>
<p>If we run the file from within gdb to debug it we get:</p>
<p><img alt="giving-malware-to-a-noob--defcon-rtv-ctf-covidscammers-writeup-02" src="../images/giving-malware-to-a-noob--defcon-rtv-ctf-covidscammers-writeup-02.png" /></p>
<blockquote>
<p>can't debug this, na na na na...</p>
</blockquote>
<p>So from the description we are looking for a syscall that is hindering the debugging of the binary. If we want to find out what syscalls are called by a program, we could determine that using the <code>strace</code> command.</p>
<p><img alt="giving-malware-to-a-noob--defcon-rtv-ctf-covidscammers-writeup-03" src="../images/giving-malware-to-a-noob--defcon-rtv-ctf-covidscammers-writeup-03.png" /></p>
<p>Just before the write syscall for the "na na na" message we see:</p>
<blockquote>
<p>ptrace(TRACE_TRACEME) = -1 EPERM (Operation not permitted)</p>
</blockquote>
<p>I'm unfamiliar with <code>ptrace</code> so I researched it and tried to understand how it could prevent debugging. I learned that <code>ptrace</code> can be used as an anti-debugging technique as can be seen <a href="https://www.aldeid.com/wiki/Ptrace-anti-debugging">here</a>.</p>
<p>Sure, enough the flag is: <code>ptrace</code>. </p>
<p>I got 5 points from this and I finally have a contribution to my team! Unfortunately, real life prevented me from continuing with the CTF and I had to bow out early.</p>
<h3 id="sidenote-how-to-bypass-ptrace">Sidenote: How to bypass ptrace?</h3>
<p>How does one bypass this anti-debugging feature? <a href="https://dev.to/denisnutiu/bypassing-ptrace-calls-with-ldpreload-on-linux-12jl">Here's one approach</a> that I tried which should work in theory but doesn't. My guess is that this particular binary has an additional way to prevent debugging, like it spawns a child process and it stays there even if you bypass ptrace. I'd have to look into this further in the future.</p>
<h2 id="shared-secrets-150-points">Shared Secrets [150 points]</h2>
<blockquote>
<p>The malware creates a shared-memory object and stores a flag inside. Recover the flag. Flag has the TS{} format, you'll know when you get it.</p>
</blockquote>
<p>I was able to solve this challenge after the CTF preliminaries ended. By this time I was already well rested and have a clearer mind. It was also at this time that I realized that the file is actually a malware and has already infected my machine. Thankfully, I was running a virtual machine which meant I could just revert back to an old working restore point.</p>
<p>Knowing that the file is a malware, the next step I did was to run <code>rkhunter</code> to look for rootkits and suspcious files. This gave me an interesting finding:</p>
<p><img alt="giving-malware-to-a-noob--defcon-rtv-ctf-covidscammers-writeup-04" src="../images/giving-malware-to-a-noob--defcon-rtv-ctf-covidscammers-writeup-04.png" /></p>
<p>Opening the suspicious file revealed this: </p>
<blockquote>
<p>KRJXW22FMVYES5CTMVBXERKUNNCWK4CJORJWCRTFFZGXERTSGBSE6IL5</p>
</blockquote>
<p>This is not the flag yet, it needs to be in the "TS{}" format as instructed in the challenge description.</p>
<p>I initially had a hard time figuring out how to decode this. It wasn't <code>base64</code> nor any other popular encoding. Thankfully, there are tools like <a href="https://gchq.github.io/CyberChef/">CyberChef</a> to help with this kind of problem. After some experimentation, the "magic" recipe did the trick and revealed to me that it was actually a <code>base32</code> encoding.</p>
<p><img alt="giving-malware-to-a-noob--defcon-rtv-ctf-covidscammers-writeup-05" src="../images/giving-malware-to-a-noob--defcon-rtv-ctf-covidscammers-writeup-05.png" /></p>
<p>This gave me the flag: <code>TS{kEepItSeCrETkEepItSaFe.MrFr0dO!}</code></p>
<h2 id="license-and-registration-100-points">License and Registration [100 points]</h2>
<blockquote>
<p>The malware creates a UUID and stores it in a file, what is the name of this file. Provide the SHA1 hash of hte full path as the flag.</p>
</blockquote>
<p>So the description above says that a file is created by the malware and stores data inside of it. I figured that the easiest way to figure out what this created file is to: </p>
<ul>
<li>Restore to a previous restore point before I opened the malware</li>
<li>Run the malware, and then;</li>
<li>Inspect which other files were created at the time of execution. </li>
</ul>
<p>I found out which files were recently created during the last 2 minutes using the following command:</p>
<div class="codehilite"><pre><span></span><code>$ find / -user kali -mmin <span class="m">2</span> -type f <span class="m">2</span>&gt; /dev/null
</code></pre></div>

<p>This showed me a lot of files, but after sifting through that I found one file that seesm promising.</p>
<blockquote>
<p>/tmp/.serverauth.tn6aUcM0uM</p>
</blockquote>
<p>To get the flag I did this:</p>
<div class="codehilite"><pre><span></span><code>$ <span class="nb">echo</span> -n <span class="s2">&quot;/tmp/.serverauth.tn6aUcM0uM&quot;</span> <span class="p">|</span> sha1sum
</code></pre></div>

<p>Which resulted in this flag: <code>5b4e97047851682649a602ad62ba4af567e352a3</code></p>
<h2 id="to-be-continued">To be continued?</h2>
<p>So I wanted to try and work on the other challenges but it seems that <a href="https://ctf.threatsims.com">the ctf site</a> is currently down. The site redirected to a different non https site and it spooked me so I stopped trying. Good thing that I had NoScript on.</p>
<p>If you want a longer and more pro writeup about the CovidScammers challenges do check out <a href="https://0xdf.gitlab.io/2020/05/04/covid-19-ctf-covidscammers.html">0xdf's writeup about it</a>.</p>
          <!-- <a class="full-article-link pull-right" rel="full-article" href="../covidscammers-writeup--defcon-rtv-ctf.html">Read on →</a> -->
      </article>
    </div>
  </div>
  <!-- CONTENT GOES HERE -->
  <div class="row">
    <div class="col-md-8 col-md-offset-2">
      <article>
        <h1><a href="../study-notes--mac-spoofing.html">Study notes: MAC Spoofing</a></h1>
	<div class="meta">
          <time datetime="2020-08-01T11:07:00+08:00">August 01, 2020</time>
          in <span class="categories">
            <a href="../tag/spoofing.html">spoofing</a>,            <a href="../tag/cybersecurity.html">cybersecurity</a>          </span>
	</div>
        <p><div class="codehilite"><pre><span></span><code>Study notes are my personal research notes on certain topics that interests me.
</code></pre></div>

<p>Any network capable device has a unique factory-assigned Media Access Control (MAC) address. Users have no way to change the MAC address but it can be done. However, it is possible to mask the MAC address and have it show a different value. This is called MAC spoofing.</p>
<p>There are legitimate uses for MAC spoofing. For example, there may be certain applications that require a particular MAC address to work, or maybe your ISP expects a certain MAC address to connect to the network. MAC spoofing is largely used for illegitimate uses, like circumventing an access control list or getting past a filter on a wireless network.</p>
<h2 id="changing-mac-address-via-ifconfig">Changing MAC Address via ifconfig</h2>
<p>In Linux we could use <code>ifconfig</code> to change the MAC address.</p>
<p>To view the current MAC address:</p>
<div class="codehilite"><pre><span></span><code>$ ifconfig
</code></pre></div>

<p>The current MAC address is <code>08:00:27:59:fb:fa</code>:</p>
<p><img alt="study-notes--mac-spoofing-01" src="../images/study-notes--mac-spoofing-01.png" /></p>
<p>Let's say we want to change the MAC address of our interface (eth0) to <code>00:11:22:33:44:55</code>.</p>
<p>First, deactivate the interface.</p>
<div class="codehilite"><pre><span></span><code>$ ifconfig eth0 down
</code></pre></div>

<p>Then we specify the mac address that we want to change to.</p>
<div class="codehilite"><pre><span></span><code>$ ifconfig eth0 hw ether <span class="m">00</span>:11:22:33:44:55
</code></pre></div>

<p>Reactive the interface:</p>
<div class="codehilite"><pre><span></span><code>$ ifconfig eth0 up
</code></pre></div>

<p>Run <code>ifconfig</code> again to see the changes.</p>
<p><img alt="study-notes--mac-spoofing-02" src="../images/study-notes--mac-spoofing-02.png" /></p>
<h3 id="note">NOTE:</h3>
<p>These changes are not permanent. The MAC address will return to the original one when the system is restarted!</p>
<h2 id="changing-the-mac-address-via-macchanger">Changing the MAC address via MACChanger</h2>
<p>There are various tools that allows easy changing of MAC addresses. <a href="https://github.com/alobbs/macchanger">MACChanger</a> is one of them.</p>
<p>First, deactivate the interface.</p>
<div class="codehilite"><pre><span></span><code>$ ifconfig eth0 down
</code></pre></div>

<p>The above below allows you specify the mac address you want to use:</p>
<div class="codehilite"><pre><span></span><code>$ macchanger -m <span class="m">00</span>:11:22:33:44:55 eth0
</code></pre></div>

<p>The code below assigns a random MAC address.</p>
<div class="codehilite"><pre><span></span><code>$ macchanger -r eth0
</code></pre></div>

<p>Reactive the interface:</p>
<div class="codehilite"><pre><span></span><code>$ ifconfig eth0 up
</code></pre></div>

<h2 id="related-reading">Related reading</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/MAC_spoofing">MAC Spoofing on Wikipedia</a></li>
<li><a href="https://www.giac.org/paper/gsec/3199/mac-spoofing-an-introduction/105315">MAC Spoofing - An introduction</a> </li>
<li><a href="https://www.comparitech.com/net-admin/spoofing-attacks-guide/">A guide to spoofing attacks and how to prevent them</a></li>
</ul>
          <!-- <a class="full-article-link pull-right" rel="full-article" href="../study-notes--mac-spoofing.html">Read on →</a> -->
      </article>
    </div>
  </div>
</div>
<div class="pagination">
<p class="paginator">
        <a href="../author/accidentalrebel.html">&#8647;</a>
        <a href="../author/accidentalrebel.html">&laquo;</a>
    Page 2 / 4
        <a href="../author/accidentalrebel3.html">&raquo;</a>
        <a href="../author/accidentalrebel4.html">&#8649;</a>
</p>
</div>
    <footer id="footer" class="her-row">
      <div class="container">
        <div class="row">
          <h4>Powered by <a href="http://blog.getpelican.com/">Pelican</a>. Designed by <a href="http://AdrianArtiles.com">Adrian Artiles</a>.</h4>
        </div>
      </div>
    </footer>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-55068085-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-55068085-2');
    </script>
  </body>
</html>