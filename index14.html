<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AccidentalRebel.com</title>
    
    <link href="https://www.accidentalrebel.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="AccidentalRebel.com Atom Feed" />
    
    <link rel="stylesheet" href="./theme/css/main.css">
    
</head>
<body>
    <div class="progress-bar" id="progress"></div>
    
    <header>
        <div class="container">
            <nav>
                <a href="./" class="site-title">AccidentalRebel.com</a>
                <button class="menu-toggle" onclick="toggleMenu()">☰</button>
                <ul class="nav-links" id="navLinks">
                    <li><a href="./archives.html">Archives</a></li>
                    <li><a href="./categories.html">Categories</a></li>
                    <li><a href="./tags.html">Tags</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Comic strip divider -->
    <div class="comic-container">
        <div class="comic-strip"></div>
    </div>

    <main>
        <div class="container">
    <article class="post-item">
        <header class="article-header">
            <h2 class="post-title">
                <a href="./chef-awrs-postmortem--what-went-wrong-optimizing-too-early-and-too-late.html">Chef Wars Postmortem -- What went wrong: Optimizing too early and too late</a>
            </h2>
            <div class="article-meta">
                <time datetime="2017-12-06T00:02:00+08:00">Wed 06 December 2017</time>
                <span>•</span>
                <a href="./category/postmortem.html">postmortem</a>
            </div>
        </header>

        <div class="article-content">
            <p><strong>Note: This is from a <a href="http://www.accidentalrebel.com/tags/chefwars_postmortem/">series of articles</a> that outlines the things I've learned while making <a href="http://mindcakegames.com/">Chef Wars</a> for 2+ years.</strong></p>
<p><strong>TLDR</strong></p>
<ul>
<li>There is more to the saying that "premature optimization is the root of all evil".</li>
<li>Instead of asking WHEN to optimize, it is more important to ask WHAT and HOW to optimize.</li>
</ul>
<hr />
<p>It is a well known adage among programmers that premature optimization is the root of all evil. If this is true then I must have been very close to the devil himself.</p>
<p>During the early months of development on Chef Wars I did my best to optimize my code as much as possible. We were making a big game and I wanted to have a stable foundation to build our game on. I obsessed over lots of things from the interconnection of the various systems to folder structures. I was happy with all that I've built, but sadly progress was slow.</p>
<p>I realized at this point that I was optimizing too prematurely. If I wanted to reach my milestones on time then I needed to change my approach. This means leaving the optimizations for later. When is later though? I figured that it makes sense to do it at the end when all the systems are in place.</p>
<p>All went smoothly until we reached Open Beta. The game was reported to be sluggish and almost unplayable which signaled the need to start optimizing. While I was able to optimize some parts, there were some that I could not optimize properly without undergoing a major change to the code. Sadly, rewrites were not an option as we were running out of time.</p>
<p><img alt="01" src="https://media.giphy.com/media/26n6T9MrKZ2Qo16Vy/giphy.gif" /></p>
<div class="codehilite"><pre><span></span><code>The profiler has been really helpful in catching performance problems.
</code></pre></div>

<p>Looking back it is easy to pinpoint what went wrong. I was optimizing too early, later changed my approach only to find out that I was already too late to optimize certain critical parts. I, of course, want to prevent this from happening again. So the million dollar question is: How does one determine when to optimize? How does one know when is too early and too late?</p>
<h2 id="the-complete-version">The complete version</h2>
<p>I later learned that the famous adage actually has a longer version:</p>
<blockquote>
<p>Programmers waste enormous amounts of time thinking about, or worrying about, the speed of noncritical parts of their programs, and these attempts at efficiency actually have a strong negative impact when debugging and maintenance are considered. We should forget about small efficiencies, say about 97% of the time: premature optimization is the root of all evil. Yet we should not pass up our opportunities in that critical 3%.</p>
</blockquote>
<p><img alt="02" src="https://i.imgur.com/dqPF0cK.jpg" /></p>
<div class="codehilite"><pre><span></span><code>From Donald Knuth&#39;s The Art of Computer Programming
</code></pre></div>

<p>Turns out there was more to the saying that completely changes the lesson to be learned. Breaking it down we can infer that the author is telling us that:</p>
<ul>
<li>Too much obsession over non-critical parts wastes time.</li>
<li>Only focus on efficiencies that matter.</li>
<li>Optimize whenever possible, but not at the expense of the previously mentioned points.</li>
</ul>
<p>So instead of asking WHEN to optimize, it is more important to ask WHAT and HOW to optimize. In other words, anytime there is a chance to evaluate if an optimization is needed, one needs to consider whether there really is something worthwhile to optimise, and if so, how to proceed in optimizing.</p>
<h2 id="answering-the-what-and-how">Answering the WHAT and HOW</h2>
<p>Knowing how to answer the WHAT and HOW is not easy and requires both experience and careful planning to get right. The internet is a bit divided about this as nobody really knows the best answer. In spite of this, I was able to gather some helpful nuggets of wisdom during my research that are worth considering:</p>
<ul>
<li>Be critical of what optimizations to use at each stage of the project. Determine how critical it is and if it can be done later.</li>
<li>If setting aside optimizations for later, make sure to prepare the code so that it would be easy to do so when the time comes.</li>
<li>Proper planning during the design stage can determine what to build and how to optimize in advance.</li>
<li>Measuring/profiling optimizations would reveal which are the most effective to use in the future.</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>There is a certain sense of pride in producing optimized and stable code. Sadly, this kind of perfection comes at a cost of time. The solution is to always consider at all times when, what, and how to optimize.</p>
<p>This may all seem overkill to worry about but after going through 2 years worth of development on Chef Wars, I know all of this is worth taking the extra effort to do right. I hope that what I've learned may also be of use to you.</p>
<p><em>[Our game is running better now and you could play it by downloading it on on <a href="https://play.google.com/store/apps/details?id=air.com.mindcakegames.chefwars&amp;hl=en">Android</a> and <a href="https://play.google.com/store/apps/details?id=air.com.mindcakegames.chefwars&amp;hl=en">iOS</a>. Also check out my <a href="http://www.accidentalrebel.com/blog/2017/12/05/chef-wars-postmortem--what-went-right-having-a-universe-file/">previous postmortem</a> where I talk about something that went right.]</em></p>
        </div>

        <div class="tags">
            <a href="./tag/chefwars.html" class="tag">chefwars</a>
            <a href="./tag/gamedev.html" class="tag">gamedev</a>
            <a href="./tag/mindcake.html" class="tag">mindcake</a>
            <span class="tag">+1 more</span>
        </div>
    </article>
    <article class="post-item">
        <header class="article-header">
            <h2 class="post-title">
                <a href="./chef-wars-postmortem--what-went-right-having-a-universe-file.html">Chef Wars Postmortem -- What went right: Having a Universe File</a>
            </h2>
            <div class="article-meta">
                <time datetime="2017-12-05T12:56:00+08:00">Tue 05 December 2017</time>
                <span>•</span>
                <a href="./category/postmortem.html">postmortem</a>
            </div>
        </header>

        <div class="article-content">
            <p><strong>Note: This is from a <a href="http://www.accidentalrebel.com/tags/chefwars_postmortem/">series of articles</a> that outlines the things I've learned while making <a href="http://mindcakegames.com/">Chef Wars</a> for 2+ years.</strong></p>
<p><strong>TLDR</strong></p>
<ul>
<li>All data in our game is contained in one excel file we call the "Universe".</li>
<li>Prototypes can be done on the Universe excel file itself</li>
<li>Iteration is easier as we only need to change one file.</li>
<li>We made a system that downloads changes from our server so players don't need to update their builds.</li>
</ul>
<hr />
<p>Before we started development on Chef Wars, Cliff, my co-founder and game designer for the team, already had pages of spreadsheets containing important values in the game. It's kinda like a game design document but in the form of tables, columns, and rows. This "Universe" file contained everything from stats, dialogue, competitions, locations, chefs, and enemies just to name a few. </p>
<p><img alt="01" src="https://i.imgur.com/rVZqbaH.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="o">*</span><span class="nx">This</span><span class="w"> </span><span class="nx">file</span><span class="w"> </span><span class="nx">definitely</span><span class="w"> </span><span class="nx">gives</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">hint</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">what</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">guy</span><span class="w"> </span><span class="nx">Cliff</span><span class="w"> </span><span class="k">is</span><span class="p">.</span><span class="o">*</span>
</code></pre></div>

<p>Having a list of all the data that will be used in the game has helped us visualize the scope and the systems to be built, especially in making prototypes. One time Cliff made a simulation of the battle system using his Excel mastery. The universe data is fed into this simulation (i.e. competition level, recipe power) and the expected values are displayed (i.e. judging result, rewards amount). This mockup allowed us to see how the battles play out and made the whole thing easier for me to understand and implement in the engine.</p>
<p>All the content of the universe file is then converted to the JSON format which is used directly by the game. Iterating on the game is easy because the file would just need to be converted again for the new changes to show up. The conversion process is done manually though using a CSV to JSON tool. I would have automated the process but didn't have the time to work on it.</p>
<p><img alt="02" src="https://i.imgur.com/lE5zqDu.png" /></p>
<div class="codehilite"><pre><span></span><code>*It&#39;s like the Matrix*
</code></pre></div>

<p>Initially, when we wanted to update some values, we would need to push a new build version that players need to download. We figured that this is too cumbersome especially if we really have some critical changes we want to get out as soon as possible. As a solution to this, we made a system where a master copy of the JSONs are saved on our servers. We can change the data from here and the game would automatically download the necessary files that we changed. This is a really great feature that has helped us push important changes without having the need for a new build. But it does require a lot of bandwidth especially if a lot of players request for the new data so we do it only when needed like on crash producing bugs.</p>
<p>As you can see, we've spent a lot of time making sure that our game is data-centric as possible and it benefitted us immensely. This approach has been so useful that we plan to use it on our future projects. And hopefully, after reading this, we've convinced you to try it out too.</p>
<p><em>[Check out how the universe has been transformed into a game by playing Chef Wars on <a href="https://play.google.com/store/apps/details?id=air.com.mindcakegames.chefwars&amp;hl=en">Android</a> and <a href="https://play.google.com/store/apps/details?id=air.com.mindcakegames.chefwars&amp;hl=en">iOS</a>. Also, be sure to check out Cliff's postmortem where he talks about the <a href="http://mindcakegames.com/chef-wars-launch-post-mortem/">things we learned during our global launch</a>!]</em></p>
        </div>

        <div class="tags">
            <a href="./tag/chefwars.html" class="tag">chefwars</a>
            <a href="./tag/gamedev.html" class="tag">gamedev</a>
            <a href="./tag/mindcake.html" class="tag">mindcake</a>
            <span class="tag">+1 more</span>
        </div>
    </article>
    <article class="post-item">
        <header class="article-header">
            <h2 class="post-title">
                <a href="./temp-solution-for-when-copying-does-not-work-in-emacs-under-windows-subsystem-for-linux.html">Temp Solution For When Text Copying Does Not Work in Emacs Under Windows Subsytem for Linux</a>
            </h2>
            <div class="article-meta">
                <time datetime="2017-09-23T13:08:00+08:00">Sat 23 September 2017</time>
                <span>•</span>
                <a href="./category/emacs.html">emacs</a>
            </div>
        </header>

        <div class="article-content">
            <p>One of the problems I was having with my Emacs environment under WSL <em>(Windows Subsystem for Linux, aka. Bash On Windows)</em> is that I could not copy text from WSL Emacs to other Windows applications. Copy and pasting from Windows to Emacs works without any problems so it's weird it does not work the other way around.</p>
<p>I tried a lot of solutions from Google but none of them seem to work. There was an emacs package called <a href="https://github.com/rolandwalker/simpleclip">simpleclip</a> that worked but the results were not consistent.</p>
<p>I then realized that a temporary solution would be to make use of Windows' clip.exe command line utility which can bme seen below.</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">arebel-set-clipboard-data</span><span class="w"> </span><span class="p">(</span><span class="nv">str-val</span><span class="p">)</span>
<span class="w">  </span><span class="s">&quot;Puts text in Windows clipboard. Copying to Windows from WSL does </span>
<span class="s">not work on my end so this one is a temporary solution.</span>

<span class="s">This function is called from within the simpleclip package when copy </span>
<span class="s">or bgcopy command is issued.&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nf">start-process</span><span class="w"> </span><span class="s">&quot;cmd&quot;</span><span class="w"> </span><span class="no">nil</span><span class="w"> </span><span class="s">&quot;cmd.exe&quot;</span><span class="w"> </span><span class="s">&quot;/C&quot;</span><span class="w"> </span><span class="p">(</span><span class="nf">concat</span><span class="w"> </span><span class="s">&quot;echo &quot;</span><span class="w"> </span><span class="p">(</span><span class="nv">replace-regexp-in-string</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="w"> </span><span class="s">&quot;\r&quot;</span><span class="w"> </span><span class="nv">str-val</span><span class="p">)</span><span class="w"> </span><span class="s">&quot; | clip.exe&quot;</span><span class="p">)))</span>
</code></pre></div>

<p>It works quite nicely especially after integrating it with simpleclip. This would do for now until I find a better solution.</p>
<blockquote>
<p><strong>EDIT (2017-10-01):</strong> Turns out the original code could not copy a region with multiple lines due to the difference in carriage return characters. This is now fixed with <code>(replace-regexp-in-string "\n" "\r" str-val)</code>.</p>
</blockquote>
        </div>

        <div class="tags">
            <a href="./tag/emacs-windows-linux.html" class="tag">emacs windows linux</a>
        </div>
    </article>

<nav class="pagination">
        <a href="./index13.html">&laquo; Previous</a>

        <a href="./index.html">1</a>
        <a href="./index2.html">2</a>
        <a href="./index3.html">3</a>
        <a href="./index4.html">4</a>
        <a href="./index5.html">5</a>
        <a href="./index6.html">6</a>
        <a href="./index7.html">7</a>
        <a href="./index8.html">8</a>
        <a href="./index9.html">9</a>
        <a href="./index10.html">10</a>
        <a href="./index11.html">11</a>
        <a href="./index12.html">12</a>
        <a href="./index13.html">13</a>
        <span class="current">14</span>
        <a href="./index15.html">15</a>

    <a href="./index15.html">Next &raquo;</a>
</nav>
        </div>
    </main>

    <script src="./theme/js/main.js"></script>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-55068085-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-55068085-2');
    </script>
</body>
</html>