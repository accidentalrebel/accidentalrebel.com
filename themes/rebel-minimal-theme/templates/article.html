{% extends "base.html" %}

{% block title %}{{ article.title }} | {{ SITENAME }}{% endblock %}

{% block canonical %}{{ article.url }}{% endblock %}

{% block meta_description %}
<meta name="description" content="{{ article.summary|striptags|truncate(160) }}">
{% endblock %}

{% block extra_head %}
    <meta name="author" content="{{ AUTHOR }}">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="{{ SITEURL }}/{{ article.url }}">
    <meta property="og:title" content="{{ article.title }}">
    <meta property="article:author" content="{{ AUTHOR }}">
    <meta property="article:published_time" content="{{ article.date.isoformat() }}">
    {% if article.summary %}
    <meta property="og:description" content="{{ article.summary|striptags }}">
    {% endif %}
    {% if article.og_image %}
    <meta property="og:image" content="{{ SITEURL }}/{{ article.og_image }}">
    {% endif %}

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="{{ SITEURL }}/{{ article.url }}">
    <meta property="twitter:title" content="{{ article.title }}">
    {% if article.summary %}
    <meta property="twitter:description" content="{{ article.summary|striptags }}">
    {% endif %}
    {% if article.og_image %}
    <meta property="twitter:image" content="{{ SITEURL }}/{{ article.og_image }}">
    {% endif %}

    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "headline": "{{ article.title }}",
        "datePublished": "{{ article.date.isoformat() }}",
        {% if article.modified %}"dateModified": "{{ article.modified.isoformat() }}",{% endif %}
        "author": { "@type": "Person", "name": "{{ AUTHOR }}" },
        "publisher": { "@type": "Person", "name": "{{ AUTHOR }}" },
        "url": "{{ SITEURL }}/{{ article.url }}",
        "description": "{{ article.summary|striptags|truncate(160) }}"
        {% if article.og_image %},"image": "{{ SITEURL }}/{{ article.og_image }}"{% endif %}
    }
    </script>

    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
            { "@type": "ListItem", "position": 1, "name": "Home", "item": "{{ SITEURL }}/" },
            { "@type": "ListItem", "position": 2, "name": "{{ article.category }}", "item": "{{ SITEURL }}/{{ article.category.url }}" },
            { "@type": "ListItem", "position": 3, "name": "{{ article.title }}" }
        ]
    }
    </script>
{% endblock %}

{% block content %}
<article>
    <header class="article-header">
        {% if article.category %}
        <a href="{{ SITEURL }}/{{ article.category.url }}" class="article-category-label">{{ article.category }}</a>
        {% endif %}
        <h1>{{ article.title }}</h1>
        <div class="article-meta">
            <time datetime="{{ article.date.isoformat() }}">{{ article.locale_date }}</time>
            {% if article.modified %}
            <span>&bull;</span>
            <span>Updated: {{ article.locale_modified }}</span>
            {% endif %}
            {% if article.readtime %}
            <span>&bull;</span>
            <span>{{ article.readtime.minutes }} min read</span>
            {% endif %}
        </div>
    </header>

    <div class="article-content">
        {{ article.content }}
    </div>

    {% if article.tags %}
    <footer class="article-footer">
        <div class="tags">
            {% for tag in article.tags %}
            <a href="{{ SITEURL }}/{{ tag.url }}" class="tag">{{ tag }}</a>
            {% endfor %}
        </div>
    </footer>
    {% endif %}
</article>

{% if article.related_posts %}
<section class="related-posts">
    <h3>Related Posts</h3>
    <ul class="post-list">
        {% for related in article.related_posts %}
        <li class="post-item">
            <h4 class="post-title">
                <a href="{{ SITEURL }}/{{ related.url }}">{{ related.title }}</a>
            </h4>
            <div class="article-meta">
                <time>{{ related.locale_date }}</time>
                {% if related.category %}
                <span>&bull;</span>
                <a href="{{ SITEURL }}/{{ related.category.url }}">{{ related.category }}</a>
                {% endif %}
            </div>
        </li>
        {% endfor %}
    </ul>
</section>
{% endif %}

{% if SITEURL and article.status != "draft" %}
<section class="comments">
    <script src="https://giscus.app/client.js"
        data-repo="accidentalrebel/accidentalrebel.com"
        data-repo-id="MDEwOlJlcG9zaXRvcnkxMTkzODk2NjU="
        data-category="Comments"
        data-category-id="DIC_kwDOBx294c4C26p7"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="light"
        data-lang="en"
        crossorigin="anonymous"
        async>
    </script>
</section>
{% endif %}
{% endblock %}
