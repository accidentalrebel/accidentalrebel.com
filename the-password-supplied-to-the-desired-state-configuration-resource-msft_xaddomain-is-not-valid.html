<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>The password supplied to the Desired State Configuration resource MSFT_xADDomain is not valid</title>
  <meta name="author" content="AccidentalRebel">

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="description" content="The password supplied to the Desired State Configuration resource MSFT_xADDomain is not valid June 25, 2022 in azure,error,troubleshooting">

  <link rel="canonical" href="/the-password-supplied-to-the-desired-state-configuration-resource-msft_xaddomain-is-not-valid.html">

  <link href="/favicon.png" rel="icon">


  <link href="/theme/css/screen.css"  media="screen, projection" rel="stylesheet" type="text/css" />
  <link href="/theme/css/tomorrow.css"  media="screen, projection" rel="stylesheet" type="text/css" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.js"></script>
  <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>

  
<meta name="twitter:card" content="summary">
<meta property="og:url" content="/the-password-supplied-to-the-desired-state-configuration-resource-msft_xaddomain-is-not-valid.html">
<meta name="twitter:site:id" content="https://twitter.com/accidentalrebel">
<meta name="twitter:creator:id" content="accidentalrebel">
<meta property="og:title" content="The password supplied to the Desired State Configuration resource MSFT">
<meta property="og:description" content="I wanted to quickly setup an Azure AD environment so I tried using this <a href="https://github.com/Azure/azure-quickstart-templates/tree/master/application-workloads/active-directory/active-direct">
<meta property="og:image" content="https://www.accidentalrebel.com/images/the-password-supplied-to-the-desired-state-configuration-resource-msft_xaddomain-is-not-valid-01.png">
<meta name="twitter:image:src" content="https://www.accidentalrebel.com/images/the-password-supplied-to-the-desired-state-configuration-resource-msft_xaddomain-is-not-valid-01.png">


</head>
  <body>

    <div class="container" id="site-title">
      <div class="col-md-8 col-md-offset-2">
	<h1>
	  <a href="https://www.accidentalrebel.com">
	    AccidentalRebel.com
	  </a>
	</h1>
	<div id="profile">
	  <div class="left">
	    <img src="/theme/images/pic.png" />
	  </div>
	  <div class="right">
	    My name is Karlo and I'm currently employed as a L2 SOC analyst. My current focus is on reverse-engineering and developing malware for research purposes.
	  </div>
	  <div class="clear"></div>
	</div>
	<div id="nav">
	  <ul>
	    <li><a href="https://www.accidentalrebel.com">Home</a></li>
	    <!-- <li><a href="/pages/made.html">My Works</a></li> -->
	    <li class="icon-nav" id="twitter-nav"><a href="https://twitter.com/accidentalrebel">Twitter</a></li>
	    <li class="icon-nav" id="github-nav"><a href="https://github.com/accidentalrebel">Github</a></li>
	    <li class="icon-nav" id="feed-nav"><a href="./feeds/all.atom.xml">RSS</a></li>
	  </ul>
	</div>
      </div>
    </div>

  <div class="container">
    <div class="row">
      <div class="col-md-8 col-md-offset-2">
	<article>
          <h1><a href="/the-password-supplied-to-the-desired-state-configuration-resource-msft_xaddomain-is-not-valid.html">The password supplied to the Desired State Configuration resource MSFT_xADDomain is not valid</a></h1>
          <div class="meta">
            <time datetime="2022-06-25T17:16:00+08:00">June 25, 2022</time>
            in <span class="categories">
              <a href="/tag/azure.html">azure</a>,              <a href="/tag/error.html">error</a>,              <a href="/tag/troubleshooting.html">troubleshooting</a>            </span>
          </div>
        <p>I wanted to quickly setup an Azure AD environment so I tried using this <a href="https://github.com/Azure/azure-quickstart-templates/tree/master/application-workloads/active-directory/active-directory-new-domain">Azure quickstart template</a>.</p>
<p>The resources were being created properly until I reached the part where the AD Forest was being created. The error that popped up was this:</p>
<div class="codehilite"><pre><span></span><code>{<span class="s2">&quot;</span><span class="s">code</span><span class="s2">&quot;</span>:<span class="s2">&quot;</span><span class="s">DeploymentFailed</span><span class="s2">&quot;</span>,<span class="s2">&quot;</span><span class="s">message</span><span class="s2">&quot;</span>:<span class="s2">&quot;</span><span class="s">At least one resource deployment operation failed. Please list deployment operations for details. Please see https://aka.ms/DeployOperations for usage details.</span><span class="s2">&quot;</span>,<span class="s2">&quot;</span><span class="s">details</span><span class="s2">&quot;</span>:[{<span class="s2">&quot;</span><span class="s">code</span><span class="s2">&quot;</span>:<span class="s2">&quot;</span><span class="s">VMExtensionProvisioningError</span><span class="s2">&quot;</span>,<span class="s2">&quot;</span><span class="s">message</span><span class="s2">&quot;</span>:<span class="s2">&quot;</span><span class="s">VM has reported a failure when processing extension &#39;CreateADForest&#39;. Error message: \</span><span class="s2">&quot;</span><span class="nv">DSC</span> <span class="nv">Configuration</span> <span class="s1">&#39;</span><span class="s">CreateADPDCf</span><span class="s1">&#39;</span> <span class="nv">completed</span> <span class="nv">with</span> <span class="nv">error</span><span class="ss">(</span><span class="nv">s</span><span class="ss">)</span>. <span class="nv">Following</span> <span class="nv">are</span> <span class="nv">the</span> <span class="nv">first</span> <span class="nv">few</span>: <span class="nv">The</span> <span class="nv">password</span> <span class="nv">supplied</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">Desired</span> <span class="nv">State</span> <span class="nv">Configuration</span> <span class="nv">resource</span> <span class="nv">MSFT_xADDomain</span> <span class="nv">is</span> <span class="nv">not</span> <span class="nv">valid</span>. <span class="nv">The</span> <span class="nv">password</span> <span class="nv">cannot</span> <span class="nv">be</span> <span class="nv">null</span> <span class="nv">or</span> <span class="nv">empty</span>. <span class="nv">The</span> <span class="nv">SendConfigurationApply</span> <span class="nv">function</span> <span class="nv">did</span> <span class="nv">not</span> <span class="nv">succeed</span>.\<span class="s2">&quot;</span><span class="s">\r</span><span class="se">\n</span><span class="s">\r</span><span class="se">\n</span><span class="s">More information on troubleshooting is available at https://aka.ms/VMExtensionDSCWindowsTroubleshoot </span><span class="s2">&quot;</span>}]}
</code></pre></div>

<p>Searching around for a solution I chanced upon <a href="https://github.com/Azure/azure-quickstart-templates/issues/12538">this Github issue</a> from the same repository.</p>
<p>A user commented that:</p>
<blockquote>
<p>"This issue seems to be caused by a security update on Windows and affects templates which use the Azure DSC extension to pass credentials (so probably many)."</p>
<p>"As a quick workaround, I hardcode a previous version of the Windows Server images which do not cause this issue (instead of using latest)."</p>
</blockquote>
<p>I looked at the fixes that the user did. It wasn't exactly for the error I am experiencing, but it was worth trying out.</p>
<p>What I had to do was to look for an old version of the VM image for WindowsServer that is needed by the quickstart template. The template's json file revealed that it's trying to use "2016-Datacenter".</p>
<p>I tried using <code>az cli</code> to check for the available vm images or WindowsServer:</p>
<div class="codehilite"><pre><span></span><code>az vm image list --offer WindowsServer --query [].urn
You are viewing an offline list of images, use --all to retrieve an up-to-date list
[
  &quot;MicrosoftWindowsServer:WindowsServer:2022-Datacenter:latest&quot;,
  &quot;MicrosoftWindowsServer:WindowsServer:2022-datacenter-azure-edition-core:latest&quot;,
  &quot;MicrosoftWindowsServer:WindowsServer:2019-Datacenter:latest&quot;,
  &quot;MicrosoftWindowsServer:WindowsServer:2016-Datacenter:latest&quot;,
  &quot;MicrosoftWindowsServer:WindowsServer:2012-R2-Datacenter:latest&quot;,
  &quot;MicrosoftWindowsServer:WindowsServer:2012-Datacenter:latest&quot;,
  &quot;MicrosoftWindowsServer:WindowsServer:2008-R2-SP1:latest&quot;
]
</code></pre></div>

<p>However, the command only lists "latest", without a version number.</p>
<p>After some searching, I finally found the list in Microsoft's support portal that <a href="https://support.microsoft.com/en-au/topic/windows-server-images-for-may-2022-6d62b503-9a57-4774-a77a-f6c99224ccd2">lists the Windows Server Images from previous months</a>.</p>
<p><img alt="the-password-supplied-to-the-desired-state-configuration-resource-msft_xaddomain-is-not-validd" src="/images/the-password-supplied-to-the-desired-state-configuration-resource-msft_xaddomain-is-not-valid-01.png" /></p>
<p>For my particular case, I used the version from the previous month, which was May, hence the value <code>14393.5125.220505</code>.</p>
<p>I then opened up <code>azuredeploy.json</code> looked for the <code>imageReference</code> entry. And changed the version to the value we got.</p>
<div class="codehilite"><pre><span></span><code>&quot;imageReference&quot;: {
     &quot;publisher&quot;: &quot;MicrosoftWindowsServer&quot;,
     &quot;offer&quot;: &quot;WindowsServer&quot;,
     &quot;sku&quot;: &quot;2016-Datacenter&quot;,
     &quot;version&quot;: &quot;14393.5125.220505&quot;
}
</code></pre></div>

<p>This fixed the issue and the template was able to create the resources successfully.</p>
        <!-- Disqus goes here -->
        <section>
          <h1>Comments</h1>
          <div id="disqus_thread" aria-live="polite">Disqus goes here</div>
	  <script>
	    /**
	     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
	     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
	    /*
	     var disqus_config = function () {
	     this.page.url = ;  // Replace PAGE_URL with your page's canonical URL variable
	     this.page.identifier = the-password-supplied-to-the-desired-state-configuration-resource-msft_xaddomain-is-not-valid.html; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
	     };
	    */
	    (function() { // DON'T EDIT BELOW THIS LINE
		var d = document, s = d.createElement('script');
		s.src = '/embed.js';
		s.setAttribute('data-timestamp', +new Date());
		(d.head || d.body).appendChild(s);
	    })();
	  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

        </section>
	</article>
      </div>
    </div>
  </div>
    <footer id="footer" class="her-row">
      <div class="container">
        <div class="row">
          <h4>Powered by <a href="http://blog.getpelican.com/">Pelican</a>. Designed by <a href="http://AdrianArtiles.com">Adrian Artiles</a>.</h4>
        </div>
      </div>
    </footer>

  </body>
</html>